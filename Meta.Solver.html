<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Meta.Solver</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a>
<a id="24" class="Keyword">module</a> <a id="31" href="Meta.Solver.html" class="Module">Meta.Solver</a> <a id="43" class="Keyword">where</a>

<a id="50" class="Keyword">open</a> <a id="55" class="Keyword">import</a> <a id="62" href="Foundations.Base.html" class="Module">Foundations.Base</a>

<a id="80" class="Keyword">open</a> <a id="85" class="Keyword">import</a> <a id="92" href="Meta.Literals.FromString.html" class="Module">Meta.Literals.FromString</a>
<a id="117" class="Keyword">open</a> <a id="122" class="Keyword">import</a> <a id="129" href="Meta.Variables.html" class="Module">Meta.Variables</a>
<a id="144" class="Keyword">open</a> <a id="149" class="Keyword">import</a> <a id="156" href="Meta.Reflection.html" class="Module">Meta.Reflection</a>

<a id="173" class="Keyword">open</a> <a id="178" class="Keyword">import</a> <a id="185" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="200" class="Keyword">open</a> <a id="205" class="Keyword">import</a> <a id="212" href="Data.List.Base.html" class="Module">Data.List.Base</a>
<a id="227" class="Keyword">open</a> <a id="232" class="Keyword">import</a> <a id="239" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a>

<a id="256" class="Keyword">private</a> <a id="264" class="Keyword">variable</a>
  <a id="275" href="Meta.Solver.html#275" class="Generalizable">ℓ</a> <a id="277" class="Symbol">:</a> <a id="279" href="Agda.Primitive.html#742" class="Postulate">Level</a>
  <a id="287" href="Meta.Solver.html#287" class="Generalizable">A</a> <a id="289" class="Symbol">:</a> <a id="291" href="Foundations.Prim.Type.html#295" class="Primitive">Type</a> <a id="296" href="Meta.Solver.html#275" class="Generalizable">ℓ</a>

<a id="299" class="Comment">--------------------------------------------------------------------------------</a>
<a id="380" class="Comment">-- Helpers</a>

<a id="solver-failed"></a><a id="392" href="Meta.Solver.html#392" class="Function">solver-failed</a> <a id="406" class="Symbol">:</a> <a id="408" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="413" class="Symbol">→</a> <a id="415" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="420" class="Symbol">→</a> <a id="422" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="425" href="Meta.Solver.html#287" class="Generalizable">A</a>
<a id="427" href="Meta.Solver.html#392" class="Function">solver-failed</a> <a id="441" href="Meta.Solver.html#441" class="Bound">lhs</a> <a id="445" href="Meta.Solver.html#445" class="Bound">rhs</a> <a id="449" class="Symbol">=</a>
    <a id="455" href="Agda.Builtin.Reflection.html#8815" class="Postulate">typeError</a> <a id="465" class="Symbol">(</a><a id="466" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="473" class="String">&quot;Could not equate the following expressions:\n  &quot;</a> <a id="523" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                 <a id="542" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="550" href="Meta.Solver.html#441" class="Bound">lhs</a> <a id="554" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
               <a id="571" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="578" class="String">&quot;\nAnd\n  &quot;</a> <a id="590" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                 <a id="609" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="617" href="Meta.Solver.html#445" class="Bound">rhs</a> <a id="621" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="623" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="625" class="Symbol">)</a>

<a id="print-repr"></a><a id="628" href="Meta.Solver.html#628" class="Function">print-repr</a> <a id="639" class="Symbol">:</a> <a id="641" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="646" class="Symbol">→</a> <a id="648" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="653" class="Symbol">→</a> <a id="655" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="658" href="Meta.Solver.html#287" class="Generalizable">A</a>
<a id="660" href="Meta.Solver.html#628" class="Function">print-repr</a> <a id="671" href="Meta.Solver.html#671" class="Bound">tm</a> <a id="674" href="Meta.Solver.html#674" class="Bound">repr</a> <a id="679" class="Symbol">=</a>
  <a id="683" href="Agda.Builtin.Reflection.html#8815" class="Postulate">typeError</a> <a id="693" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="695" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="702" class="String">&quot;The expression\n  &quot;</a> <a id="723" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                <a id="741" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="749" href="Meta.Solver.html#671" class="Bound">tm</a> <a id="752" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
              <a id="768" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="775" class="String">&quot;\nIs represented by the expression\n  &quot;</a> <a id="816" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                <a id="834" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="842" href="Meta.Solver.html#674" class="Bound">repr</a> <a id="847" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="849" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

<a id="print-var-repr"></a><a id="853" href="Meta.Solver.html#853" class="Function">print-var-repr</a> <a id="868" class="Symbol">:</a> <a id="870" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="875" class="Symbol">→</a> <a id="877" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="882" class="Symbol">→</a> <a id="884" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="889" class="Symbol">→</a> <a id="891" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="894" href="Meta.Solver.html#287" class="Generalizable">A</a>
<a id="896" href="Meta.Solver.html#853" class="Function">print-var-repr</a> <a id="911" href="Meta.Solver.html#911" class="Bound">tm</a> <a id="914" href="Meta.Solver.html#914" class="Bound">repr</a> <a id="919" href="Meta.Solver.html#919" class="Bound">env</a> <a id="923" class="Symbol">=</a>
  <a id="927" href="Agda.Builtin.Reflection.html#8815" class="Postulate">typeError</a> <a id="937" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="939" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="946" class="String">&quot;The expression\n  &quot;</a> <a id="967" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                <a id="985" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="993" href="Meta.Solver.html#911" class="Bound">tm</a> <a id="996" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
              <a id="1012" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="1019" class="String">&quot;\nIs represented by the expression\n  &quot;</a> <a id="1060" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                <a id="1078" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="1086" href="Meta.Solver.html#914" class="Bound">repr</a> <a id="1091" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
              <a id="1107" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="1114" class="String">&quot;\nIn the environment\n  &quot;</a> <a id="1141" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                <a id="1159" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="1167" href="Meta.Solver.html#919" class="Bound">env</a> <a id="1171" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1173" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>

<a id="1177" class="Comment">--------------------------------------------------------------------------------</a>
<a id="1258" class="Comment">-- Simple Solvers</a>

<a id="1277" class="Keyword">record</a> <a id="SimpleSolver"></a><a id="1284" href="Meta.Solver.html#1284" class="Record">SimpleSolver</a> <a id="1297" class="Symbol">:</a> <a id="1299" href="Foundations.Prim.Type.html#295" class="Primitive">Type</a> <a id="1304" class="Keyword">where</a>
  <a id="1312" class="Keyword">constructor</a> <a id="simple-solver"></a><a id="1324" href="Meta.Solver.html#1324" class="InductiveConstructor">simple-solver</a>
  <a id="1340" class="Keyword">field</a>
    <a id="SimpleSolver.dont-reduce"></a><a id="1350" href="Meta.Solver.html#1350" class="Field">dont-reduce</a> <a id="1362" class="Symbol">:</a> <a id="1364" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1369" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a>
    <a id="SimpleSolver.build-expr"></a><a id="1378" href="Meta.Solver.html#1378" class="Field">build-expr</a> <a id="1389" class="Symbol">:</a> <a id="1391" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="1396" class="Symbol">→</a> <a id="1398" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="1401" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
    <a id="SimpleSolver.invoke-solver"></a><a id="1410" href="Meta.Solver.html#1410" class="Field">invoke-solver</a> <a id="1424" class="Symbol">:</a> <a id="1426" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="1431" class="Symbol">→</a> <a id="1433" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="1438" class="Symbol">→</a> <a id="1440" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
    <a id="SimpleSolver.invoke-normaliser"></a><a id="1449" href="Meta.Solver.html#1449" class="Field">invoke-normaliser</a> <a id="1467" class="Symbol">:</a> <a id="1469" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="1474" class="Symbol">→</a> <a id="1476" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>

<a id="1482" class="Keyword">module</a> <a id="1489" href="Meta.Solver.html#1489" class="Module">_</a> <a id="1491" class="Symbol">(</a><a id="1492" href="Meta.Solver.html#1492" class="Bound">solver</a> <a id="1499" class="Symbol">:</a> <a id="1501" href="Meta.Solver.html#1284" class="Record">SimpleSolver</a><a id="1513" class="Symbol">)</a> <a id="1515" class="Keyword">where</a>
  <a id="1523" class="Keyword">open</a> <a id="1528" href="Meta.Solver.html#1284" class="Module">SimpleSolver</a> <a id="1541" href="Meta.Solver.html#1492" class="Bound">solver</a>

  <a id="1551" href="Meta.Solver.html#1551" class="Function">mk-simple-solver</a> <a id="1568" class="Symbol">:</a> <a id="1570" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="1575" class="Symbol">→</a> <a id="1577" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="1580" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="1584" href="Meta.Solver.html#1551" class="Function">mk-simple-solver</a> <a id="1601" href="Meta.Solver.html#1601" class="Bound">hole</a> <a id="1606" class="Symbol">=</a>
    <a id="1612" href="Agda.Builtin.Reflection.html#10125" class="Postulate">withNormalisation</a> <a id="1630" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="1636" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a>
    <a id="1642" href="Agda.Builtin.Reflection.html#10769" class="Postulate">withReduceDefs</a> <a id="1657" class="Symbol">(</a><a id="1658" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="1664" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1666" href="Meta.Solver.html#1350" class="Field">dont-reduce</a><a id="1677" class="Symbol">)</a> <a id="1679" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="1681" class="Keyword">do</a>
    <a id="1688" href="Meta.Solver.html#1688" class="Bound">goal</a> <a id="1693" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="1695" href="Agda.Builtin.Reflection.html#8878" class="Postulate">inferType</a> <a id="1705" href="Meta.Solver.html#1601" class="Bound">hole</a> <a id="1710" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="1714" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a>
    <a id="1725" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="1730" class="Symbol">(</a><a id="1731" href="Meta.Solver.html#1731" class="Bound">lhs</a> <a id="1735" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1737" href="Meta.Solver.html#1737" class="Bound">rhs</a><a id="1740" class="Symbol">)</a> <a id="1742" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="1744" href="Meta.Reflection.html#6987" class="Function">get-boundary</a> <a id="1757" href="Meta.Solver.html#1688" class="Bound">goal</a>
      <a id="1768" class="Keyword">where</a> <a id="1774" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="1782" class="Symbol">→</a> <a id="1784" href="Agda.Builtin.Reflection.html#8815" class="Postulate">typeError</a> <a id="1794" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="1796" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="1803" class="String">&quot;Can&#39;t determine boundary: &quot;</a> <a id="1832" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                                  <a id="1868" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="1876" href="Meta.Solver.html#1688" class="Bound">goal</a> <a id="1881" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1883" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
    <a id="1890" href="Meta.Solver.html#1890" class="Bound">elhs</a> <a id="1895" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="1897" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="1907" href="Meta.Solver.html#1731" class="Bound">lhs</a> <a id="1911" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="1915" href="Meta.Solver.html#1378" class="Field">build-expr</a>
    <a id="1930" href="Meta.Solver.html#1930" class="Bound">erhs</a> <a id="1935" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="1937" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="1947" href="Meta.Solver.html#1737" class="Bound">rhs</a> <a id="1951" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="1955" href="Meta.Solver.html#1378" class="Field">build-expr</a>
    <a id="1970" class="Symbol">(</a><a id="1971" href="Agda.Builtin.Reflection.html#11202" class="Postulate">noConstraints</a> <a id="1985" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="1987" href="Agda.Builtin.Reflection.html#8775" class="Postulate">unify</a> <a id="1993" href="Meta.Solver.html#1601" class="Bound">hole</a> <a id="1998" class="Symbol">(</a><a id="1999" href="Meta.Solver.html#1410" class="Field">invoke-solver</a> <a id="2013" href="Meta.Solver.html#1890" class="Bound">elhs</a> <a id="2018" href="Meta.Solver.html#1930" class="Bound">erhs</a><a id="2022" class="Symbol">))</a> <a id="2025" href="Meta.Alt.html#315" class="Field Operator">&lt;|&gt;</a> <a id="2029" href="Meta.Solver.html#392" class="Function">solver-failed</a> <a id="2043" href="Meta.Solver.html#1890" class="Bound">elhs</a> <a id="2048" href="Meta.Solver.html#1930" class="Bound">erhs</a>

  <a id="2056" href="Meta.Solver.html#2056" class="Function">mk-simple-normalise</a> <a id="2076" class="Symbol">:</a> <a id="2078" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2083" class="Symbol">→</a> <a id="2085" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2090" class="Symbol">→</a> <a id="2092" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="2095" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="2099" href="Meta.Solver.html#2056" class="Function">mk-simple-normalise</a> <a id="2119" href="Meta.Solver.html#2119" class="Bound">tm</a> <a id="2122" href="Meta.Solver.html#2122" class="Bound">hole</a> <a id="2127" class="Symbol">=</a>
    <a id="2133" href="Agda.Builtin.Reflection.html#10125" class="Postulate">withNormalisation</a> <a id="2151" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="2157" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a>
    <a id="2163" href="Agda.Builtin.Reflection.html#10769" class="Postulate">withReduceDefs</a> <a id="2178" class="Symbol">(</a><a id="2179" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="2185" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2187" href="Meta.Solver.html#1350" class="Field">dont-reduce</a><a id="2198" class="Symbol">)</a> <a id="2200" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="2202" class="Keyword">do</a>
    <a id="2209" href="Meta.Solver.html#2209" class="Bound">e</a> <a id="2211" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="2213" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="2223" href="Meta.Solver.html#2119" class="Bound">tm</a> <a id="2226" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="2230" href="Meta.Solver.html#1378" class="Field">build-expr</a>
    <a id="2245" href="Agda.Builtin.Reflection.html#8775" class="Postulate">unify</a> <a id="2251" href="Meta.Solver.html#2122" class="Bound">hole</a> <a id="2256" class="Symbol">(</a><a id="2257" href="Meta.Solver.html#1449" class="Field">invoke-normaliser</a> <a id="2275" href="Meta.Solver.html#2209" class="Bound">e</a><a id="2276" class="Symbol">)</a>

  <a id="2281" href="Meta.Solver.html#2281" class="Function">mk-simple-repr</a> <a id="2296" class="Symbol">:</a> <a id="2298" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2303" class="Symbol">→</a> <a id="2305" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="2308" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="2312" href="Meta.Solver.html#2281" class="Function">mk-simple-repr</a> <a id="2327" href="Meta.Solver.html#2327" class="Bound">tm</a> <a id="2330" class="Symbol">=</a>
    <a id="2336" href="Agda.Builtin.Reflection.html#10125" class="Postulate">withNormalisation</a> <a id="2354" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="2360" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a>
    <a id="2366" href="Agda.Builtin.Reflection.html#10769" class="Postulate">withReduceDefs</a> <a id="2381" class="Symbol">(</a><a id="2382" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="2388" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="2390" href="Meta.Solver.html#1350" class="Field">dont-reduce</a><a id="2401" class="Symbol">)</a> <a id="2403" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="2405" class="Keyword">do</a>
    <a id="2412" href="Meta.Solver.html#2412" class="Bound">repr</a> <a id="2417" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="2419" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="2429" href="Meta.Solver.html#2327" class="Bound">tm</a> <a id="2432" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="2436" href="Meta.Solver.html#1378" class="Field">build-expr</a>
    <a id="2451" href="Meta.Solver.html#628" class="Function">print-repr</a> <a id="2462" href="Meta.Solver.html#2327" class="Bound">tm</a> <a id="2465" href="Meta.Solver.html#2412" class="Bound">repr</a>

<a id="2471" class="Comment">--------------------------------------------------------------------------------</a>
<a id="2552" class="Comment">-- Solvers with Variables</a>

<a id="2579" class="Keyword">record</a> <a id="VariableSolver"></a><a id="2586" href="Meta.Solver.html#2586" class="Record">VariableSolver</a> <a id="2601" class="Symbol">{</a><a id="2602" href="Meta.Solver.html#2602" class="Bound">ℓ</a><a id="2603" class="Symbol">}</a> <a id="2605" class="Symbol">(</a><a id="2606" href="Meta.Solver.html#2606" class="Bound">A</a> <a id="2608" class="Symbol">:</a> <a id="2610" href="Foundations.Prim.Type.html#295" class="Primitive">Type</a> <a id="2615" href="Meta.Solver.html#2602" class="Bound">ℓ</a><a id="2616" class="Symbol">)</a> <a id="2618" class="Symbol">:</a> <a id="2620" href="Foundations.Prim.Type.html#295" class="Primitive">Type</a> <a id="2625" href="Meta.Solver.html#2602" class="Bound">ℓ</a> <a id="2627" class="Keyword">where</a>
  <a id="2635" class="Keyword">constructor</a> <a id="var-solver"></a><a id="2647" href="Meta.Solver.html#2647" class="InductiveConstructor">var-solver</a>
  <a id="2660" class="Keyword">field</a>
    <a id="VariableSolver.dont-reduce"></a><a id="2670" href="Meta.Solver.html#2670" class="Field">dont-reduce</a> <a id="2682" class="Symbol">:</a> <a id="2684" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2689" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a>
    <a id="VariableSolver.build-expr"></a><a id="2698" href="Meta.Solver.html#2698" class="Field">build-expr</a> <a id="2709" class="Symbol">:</a> <a id="2711" href="Meta.Variables.html#1839" class="Record">Variables</a> <a id="2721" href="Meta.Solver.html#2606" class="Bound">A</a> <a id="2723" class="Symbol">→</a> <a id="2725" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2730" class="Symbol">→</a> <a id="2732" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="2735" class="Symbol">(</a><a id="2736" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2741" href="Foundations.Sigma.Base.html#498" class="Function Operator">×</a> <a id="2743" href="Meta.Variables.html#1839" class="Record">Variables</a> <a id="2753" href="Meta.Solver.html#2606" class="Bound">A</a><a id="2754" class="Symbol">)</a>
    <a id="VariableSolver.invoke-solver"></a><a id="2760" href="Meta.Solver.html#2760" class="Field">invoke-solver</a> <a id="2774" class="Symbol">:</a> <a id="2776" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2781" class="Symbol">→</a> <a id="2783" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2788" class="Symbol">→</a> <a id="2790" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2795" class="Symbol">→</a> <a id="2797" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
    <a id="VariableSolver.invoke-normaliser"></a><a id="2806" href="Meta.Solver.html#2806" class="Field">invoke-normaliser</a> <a id="2824" class="Symbol">:</a> <a id="2826" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2831" class="Symbol">→</a> <a id="2833" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2838" class="Symbol">→</a> <a id="2840" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>

<a id="2846" class="Keyword">module</a> <a id="2853" href="Meta.Solver.html#2853" class="Module">_</a> <a id="2855" class="Symbol">{</a><a id="2856" href="Meta.Solver.html#2856" class="Bound">ℓ</a><a id="2857" class="Symbol">}</a> <a id="2859" class="Symbol">{</a><a id="2860" href="Meta.Solver.html#2860" class="Bound">A</a> <a id="2862" class="Symbol">:</a> <a id="2864" href="Foundations.Prim.Type.html#295" class="Primitive">Type</a> <a id="2869" href="Meta.Solver.html#2856" class="Bound">ℓ</a><a id="2870" class="Symbol">}</a> <a id="2872" class="Symbol">(</a><a id="2873" href="Meta.Solver.html#2873" class="Bound">solver</a> <a id="2880" class="Symbol">:</a> <a id="2882" href="Meta.Solver.html#2586" class="Record">VariableSolver</a> <a id="2897" href="Meta.Solver.html#2860" class="Bound">A</a><a id="2898" class="Symbol">)</a> <a id="2900" class="Keyword">where</a>
  <a id="2908" class="Keyword">open</a> <a id="2913" href="Meta.Solver.html#2586" class="Module">VariableSolver</a> <a id="2928" href="Meta.Solver.html#2873" class="Bound">solver</a>

  <a id="2938" href="Meta.Solver.html#2938" class="Function">mk-var-solver</a> <a id="2952" class="Symbol">:</a> <a id="2954" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="2959" class="Symbol">→</a> <a id="2961" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="2964" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="2968" href="Meta.Solver.html#2938" class="Function">mk-var-solver</a> <a id="2982" href="Meta.Solver.html#2982" class="Bound">hole</a> <a id="2987" class="Symbol">=</a>
    <a id="2993" href="Agda.Builtin.Reflection.html#10125" class="Postulate">withNormalisation</a> <a id="3011" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="3017" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a>
    <a id="3023" href="Agda.Builtin.Reflection.html#10769" class="Postulate">withReduceDefs</a> <a id="3038" class="Symbol">(</a><a id="3039" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="3045" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3047" href="Meta.Solver.html#2670" class="Field">dont-reduce</a><a id="3058" class="Symbol">)</a> <a id="3060" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="3062" class="Keyword">do</a>
    <a id="3069" href="Meta.Solver.html#3069" class="Bound">goal</a> <a id="3074" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3076" href="Agda.Builtin.Reflection.html#8878" class="Postulate">inferType</a> <a id="3086" href="Meta.Solver.html#2982" class="Bound">hole</a> <a id="3091" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="3095" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a>
    <a id="3106" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3111" class="Symbol">(</a><a id="3112" href="Meta.Solver.html#3112" class="Bound">lhs</a> <a id="3116" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3118" href="Meta.Solver.html#3118" class="Bound">rhs</a><a id="3121" class="Symbol">)</a> <a id="3123" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3125" href="Meta.Reflection.html#6987" class="Function">get-boundary</a> <a id="3138" href="Meta.Solver.html#3069" class="Bound">goal</a>
      <a id="3149" class="Keyword">where</a> <a id="3155" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="3163" class="Symbol">→</a> <a id="3165" href="Agda.Builtin.Reflection.html#8815" class="Postulate">typeError</a> <a id="3175" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="3177" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="3184" class="String">&quot;Can&#39;t determine boundary: &quot;</a> <a id="3213" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                                  <a id="3249" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="3257" href="Meta.Solver.html#3069" class="Bound">goal</a> <a id="3262" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3264" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
    <a id="3271" href="Meta.Solver.html#3271" class="Bound">elhs</a> <a id="3276" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3278" href="Meta.Solver.html#3278" class="Bound">vs</a> <a id="3281" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3283" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="3293" href="Meta.Solver.html#3112" class="Bound">lhs</a> <a id="3297" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="3301" href="Meta.Solver.html#2698" class="Field">build-expr</a> <a id="3312" href="Meta.Variables.html#2150" class="Function">empty-vars</a>
    <a id="3327" href="Meta.Solver.html#3327" class="Bound">erhs</a> <a id="3332" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3334" href="Meta.Solver.html#3334" class="Bound">vs</a> <a id="3337" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3339" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="3349" href="Meta.Solver.html#3118" class="Bound">rhs</a> <a id="3353" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="3357" href="Meta.Solver.html#2698" class="Field">build-expr</a> <a id="3368" href="Meta.Solver.html#3278" class="Bound">vs</a>
    <a id="3375" href="Meta.Solver.html#3375" class="Bound">size</a> <a id="3380" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3382" href="Meta.Solver.html#3382" class="Bound">env</a> <a id="3386" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3388" href="Meta.Variables.html#3414" class="Function">environment</a> <a id="3400" href="Meta.Solver.html#3334" class="Bound">vs</a>
    <a id="3407" class="Symbol">(</a><a id="3408" href="Agda.Builtin.Reflection.html#11202" class="Postulate">noConstraints</a> <a id="3422" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="3424" href="Agda.Builtin.Reflection.html#8775" class="Postulate">unify</a> <a id="3430" href="Meta.Solver.html#2982" class="Bound">hole</a> <a id="3435" class="Symbol">(</a><a id="3436" href="Meta.Solver.html#2760" class="Field">invoke-solver</a> <a id="3450" href="Meta.Solver.html#3271" class="Bound">elhs</a> <a id="3455" href="Meta.Solver.html#3327" class="Bound">erhs</a> <a id="3460" href="Meta.Solver.html#3382" class="Bound">env</a><a id="3463" class="Symbol">))</a> <a id="3466" href="Meta.Alt.html#315" class="Field Operator">&lt;|&gt;</a>
      <a id="3476" href="Agda.Builtin.Reflection.html#8815" class="Postulate">typeError</a> <a id="3486" class="Symbol">(</a><a id="3487" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="3494" class="String">&quot;Could not equate the following expressions:\n  &quot;</a> <a id="3544" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                   <a id="3565" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="3573" href="Meta.Solver.html#3271" class="Bound">elhs</a> <a id="3578" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                 <a id="3597" href="Agda.Builtin.Reflection.html#8223" class="InductiveConstructor">strErr</a> <a id="3604" class="String">&quot;\nAnd\n  &quot;</a> <a id="3616" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
                   <a id="3637" href="Agda.Builtin.Reflection.html#8254" class="InductiveConstructor">termErr</a> <a id="3645" href="Meta.Solver.html#3327" class="Bound">erhs</a> <a id="3650" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="3652" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="3654" class="Symbol">)</a>

  <a id="3659" href="Meta.Solver.html#3659" class="Function">mk-var-normalise</a> <a id="3676" class="Symbol">:</a> <a id="3678" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="3683" class="Symbol">→</a> <a id="3685" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="3690" class="Symbol">→</a> <a id="3692" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="3695" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="3699" href="Meta.Solver.html#3659" class="Function">mk-var-normalise</a> <a id="3716" href="Meta.Solver.html#3716" class="Bound">tm</a> <a id="3719" href="Meta.Solver.html#3719" class="Bound">hole</a> <a id="3724" class="Symbol">=</a>
    <a id="3730" href="Agda.Builtin.Reflection.html#10125" class="Postulate">withNormalisation</a> <a id="3748" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="3754" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a>
    <a id="3760" href="Agda.Builtin.Reflection.html#10769" class="Postulate">withReduceDefs</a> <a id="3775" class="Symbol">(</a><a id="3776" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="3782" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3784" href="Meta.Solver.html#2670" class="Field">dont-reduce</a><a id="3795" class="Symbol">)</a> <a id="3797" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="3799" class="Keyword">do</a>
    <a id="3806" href="Meta.Solver.html#3806" class="Bound">e</a> <a id="3808" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3810" href="Meta.Solver.html#3810" class="Bound">vs</a> <a id="3813" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3815" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="3825" href="Meta.Solver.html#3716" class="Bound">tm</a> <a id="3828" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="3832" href="Meta.Solver.html#2698" class="Field">build-expr</a> <a id="3843" href="Meta.Variables.html#2150" class="Function">empty-vars</a>
    <a id="3858" href="Meta.Solver.html#3858" class="Bound">size</a> <a id="3863" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3865" href="Meta.Solver.html#3865" class="Bound">env</a> <a id="3869" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3871" href="Meta.Variables.html#3414" class="Function">environment</a> <a id="3883" href="Meta.Solver.html#3810" class="Bound">vs</a>
    <a id="3890" href="Meta.Solver.html#3890" class="Bound">soln</a> <a id="3895" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="3897" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="3904" class="Symbol">(</a><a id="3905" href="Meta.Solver.html#2806" class="Field">invoke-normaliser</a> <a id="3923" href="Meta.Solver.html#3806" class="Bound">e</a> <a id="3925" href="Meta.Solver.html#3865" class="Bound">env</a><a id="3928" class="Symbol">)</a>
    <a id="3934" href="Agda.Builtin.Reflection.html#8775" class="Postulate">unify</a> <a id="3940" href="Meta.Solver.html#3719" class="Bound">hole</a> <a id="3945" href="Meta.Solver.html#3890" class="Bound">soln</a>

  <a id="3953" href="Meta.Solver.html#3953" class="Function">mk-var-repr</a> <a id="3965" class="Symbol">:</a> <a id="3967" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="3972" class="Symbol">→</a> <a id="3974" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="3977" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
  <a id="3981" href="Meta.Solver.html#3953" class="Function">mk-var-repr</a> <a id="3993" href="Meta.Solver.html#3993" class="Bound">tm</a> <a id="3996" class="Symbol">=</a>
    <a id="4002" href="Agda.Builtin.Reflection.html#10125" class="Postulate">withNormalisation</a> <a id="4020" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="4026" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a>
    <a id="4032" href="Agda.Builtin.Reflection.html#10769" class="Postulate">withReduceDefs</a> <a id="4047" class="Symbol">(</a><a id="4048" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="4054" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4056" href="Meta.Solver.html#2670" class="Field">dont-reduce</a><a id="4067" class="Symbol">)</a> <a id="4069" href="Foundations.Pi.Base.html#957" class="Function Operator">$</a> <a id="4071" class="Keyword">do</a>
    <a id="4078" href="Meta.Solver.html#4078" class="Bound">repr</a> <a id="4083" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4085" href="Meta.Solver.html#4085" class="Bound">vs</a> <a id="4088" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="4090" href="Agda.Builtin.Reflection.html#8957" class="Postulate">normalise</a> <a id="4100" href="Meta.Solver.html#3993" class="Bound">tm</a> <a id="4103" href="Meta.Bind.html#190" class="Field Operator">&gt;&gt;=</a> <a id="4107" href="Meta.Solver.html#2698" class="Field">build-expr</a> <a id="4118" href="Meta.Variables.html#2150" class="Function">empty-vars</a>
    <a id="4133" href="Meta.Solver.html#4133" class="Bound">size</a> <a id="4138" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4140" href="Meta.Solver.html#4140" class="Bound">env</a> <a id="4144" href="Meta.Bind.html#190" class="Field Operator">←</a> <a id="4146" href="Meta.Variables.html#3414" class="Function">environment</a> <a id="4158" href="Meta.Solver.html#4085" class="Bound">vs</a>
    <a id="4165" href="Meta.Solver.html#853" class="Function">print-var-repr</a> <a id="4180" href="Meta.Solver.html#3993" class="Bound">tm</a> <a id="4183" href="Meta.Solver.html#4078" class="Bound">repr</a> <a id="4188" href="Meta.Solver.html#4140" class="Bound">env</a>
</pre></body></html>