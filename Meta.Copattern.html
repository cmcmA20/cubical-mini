<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Meta.Copattern</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Reed Mullanix 2024</a>
<a id="23" class="Symbol">{-#</a> <a id="27" class="Keyword">OPTIONS</a> <a id="35" class="Pragma">--safe</a> <a id="42" class="Pragma">--no-exact-split</a> <a id="59" class="Symbol">#-}</a>
<a id="63" class="Keyword">module</a> <a id="70" href="Meta.Copattern.html" class="Module">Meta.Copattern</a> <a id="85" class="Keyword">where</a>

<a id="92" class="Keyword">open</a> <a id="97" class="Keyword">import</a> <a id="104" href="Foundations.Prelude.html" class="Module">Foundations.Prelude</a>

<a id="125" class="Keyword">open</a> <a id="130" class="Keyword">import</a> <a id="137" href="Meta.Effect.Traversable.html" class="Module">Meta.Effect.Traversable</a>
<a id="161" class="Keyword">open</a> <a id="166" class="Keyword">import</a> <a id="173" href="Meta.Reflection.Argument.html" class="Module">Meta.Reflection.Argument</a>
<a id="198" class="Keyword">open</a> <a id="203" class="Keyword">import</a> <a id="210" href="Meta.Reflection.Base.html" class="Module">Meta.Reflection.Base</a>
<a id="231" class="Keyword">open</a> <a id="236" class="Keyword">import</a> <a id="243" href="Meta.Reflection.Signature.html" class="Module">Meta.Reflection.Signature</a>
<a id="269" class="Keyword">open</a> <a id="274" class="Keyword">import</a> <a id="281" href="Meta.Reflection.Subst.html" class="Module">Meta.Reflection.Subst</a>

<a id="304" class="Keyword">open</a> <a id="309" class="Keyword">import</a> <a id="316" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="331" class="Keyword">open</a> <a id="336" class="Keyword">import</a> <a id="343" href="Data.List.Base.html" class="Module">Data.List.Base</a>
<a id="358" class="Keyword">open</a> <a id="363" class="Keyword">import</a> <a id="370" href="Data.List.Operations.html" class="Module">Data.List.Operations</a>
<a id="391" class="Keyword">open</a> <a id="396" class="Keyword">import</a> <a id="403" href="Data.List.Instances.FromProduct.html" class="Module">Data.List.Instances.FromProduct</a>
<a id="435" class="Keyword">open</a> <a id="440" class="Keyword">import</a> <a id="447" href="Data.List.Instances.Traversable.html" class="Module">Data.List.Instances.Traversable</a>
<a id="479" class="Keyword">open</a> <a id="484" class="Keyword">import</a> <a id="491" href="Data.Reflection.Argument.html" class="Module">Data.Reflection.Argument</a>
<a id="516" class="Keyword">open</a> <a id="521" class="Keyword">import</a> <a id="528" href="Data.Reflection.Error.html" class="Module">Data.Reflection.Error</a>
<a id="550" class="Keyword">open</a> <a id="555" class="Keyword">import</a> <a id="562" href="Data.Reflection.Instances.FromString.html" class="Module">Data.Reflection.Instances.FromString</a>
<a id="599" class="Keyword">open</a> <a id="604" class="Keyword">import</a> <a id="611" href="Data.Reflection.Name.html" class="Module">Data.Reflection.Name</a>
<a id="632" class="Keyword">open</a> <a id="637" class="Keyword">import</a> <a id="644" href="Data.Reflection.Term.html" class="Module">Data.Reflection.Term</a>

<a id="666" class="Comment">--------------------------------------------------------------------------------</a>
<a id="747" class="Comment">-- Macros for manipulating copattern definitions.</a>

<a id="798" class="Comment">-- Make a top-level copattern binding for an existing record.</a>
<a id="make-copattern"></a><a id="860" href="Meta.Copattern.html#860" class="Function">make-copattern</a> <a id="875" class="Symbol">:</a> <a id="877" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="882" class="Symbol">→</a> <a id="884" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="889" class="Symbol">→</a> <a id="891" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="896" class="Symbol">→</a> <a id="898" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="903" class="Symbol">→</a> <a id="905" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="908" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="910" href="Meta.Copattern.html#860" class="Function">make-copattern</a> <a id="925" href="Meta.Copattern.html#925" class="Bound">declare?</a> <a id="934" href="Meta.Copattern.html#934" class="Bound">def-name</a> <a id="943" href="Meta.Copattern.html#943" class="Bound">tm</a> <a id="946" href="Meta.Copattern.html#946" class="Bound">tp</a> <a id="949" class="Symbol">=</a> <a id="951" class="Keyword">do</a>
  <a id="956" class="Comment">-- Ensure that codomain is a record type.</a>
  <a id="1000" class="Keyword">let</a> <a id="1004" href="Meta.Copattern.html#1004" class="Bound">tele</a> <a id="1009" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1011" href="Meta.Copattern.html#1011" class="Bound">cod-tp</a> <a id="1018" class="Symbol">=</a> <a id="1020" href="Data.Reflection.Term.html#1422" class="Function">pi-view</a> <a id="1028" href="Meta.Copattern.html#946" class="Bound">tp</a>
  <a id="1033" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="1037" href="Meta.Copattern.html#1037" class="Bound">rec-name</a> <a id="1046" href="Meta.Copattern.html#1046" class="Bound">params</a> <a id="1053" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1055" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="1060" href="Meta.Copattern.html#1011" class="Bound">cod-tp</a>
    <a id="1071" class="Keyword">where</a> <a id="1077" class="CatchallClause Symbol">_</a> <a id="1079" class="Symbol">→</a> <a id="1081" href="Agda.Builtin.Reflection.html#8815" class="Postulate">type-error</a> <a id="1092" href="Meta.Literals.FromProduct.html#385" class="Function Operator">[</a> <a id="1094" class="String">&quot;make-copattern: codomain of &quot;</a> <a id="1125" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1127" href="Data.Reflection.Error.html#191" class="InductiveConstructor">term-err</a> <a id="1136" href="Meta.Copattern.html#946" class="Bound">tp</a> <a id="1139" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1141" class="String">&quot; is not a record type.&quot;</a> <a id="1166" href="Meta.Literals.FromProduct.html#385" class="Function Operator">]</a>

  <a id="1171" href="Meta.Copattern.html#1171" class="Bound">inst-tm</a> <a id="1179" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1181" href="Meta.Reflection.Subst.html#7976" class="Function">apply*TC</a> <a id="1190" href="Meta.Copattern.html#943" class="Bound">tm</a> <a id="1193" class="Symbol">(</a><a id="1194" href="Meta.Reflection.Base.html#5098" class="Function">tel→args</a> <a id="1203" class="Number">0</a> <a id="1205" href="Meta.Copattern.html#1004" class="Bound">tele</a><a id="1209" class="Symbol">)</a>

  <a id="1214" class="Comment">-- Construct copattern clauses for each field.</a>
  <a id="1263" href="Meta.Copattern.html#1263" class="Bound">ctor</a> <a id="1268" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1270" href="Meta.Copattern.html#1270" class="Bound">fields</a> <a id="1277" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1279" href="Meta.Reflection.Signature.html#1415" class="Function">get-record-type</a> <a id="1295" href="Meta.Copattern.html#1037" class="Bound">rec-name</a>
  <a id="1306" href="Meta.Copattern.html#1306" class="Bound">clauses</a> <a id="1314" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a>
    <a id="1320" href="Agda.Builtin.Reflection.html#9350" class="Postulate">in-context</a> <a id="1331" class="Symbol">(</a><a id="1332" href="Data.List.Base.html#955" class="Function">reverse-fast</a> <a id="1345" href="Meta.Copattern.html#1004" class="Bound">tele</a><a id="1349" class="Symbol">)</a> <a id="1351" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a>
      <a id="1359" href="Meta.Effect.Traversable.html#396" class="Function">for</a> <a id="1363" href="Meta.Copattern.html#1270" class="Bound">fields</a> <a id="1370" class="Symbol">λ</a> <a id="1372" class="Keyword">where</a> <a id="1378" class="Symbol">(</a><a id="1379" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="1383" href="Meta.Copattern.html#1383" class="Bound">field-info</a> <a id="1394" href="Meta.Copattern.html#1394" class="Bound">field-name</a><a id="1404" class="Symbol">)</a> <a id="1406" class="Symbol">→</a> <a id="1408" class="Keyword">do</a>
      <a id="1417" class="Comment">-- Infer the type of the field with all known arguments instantiated.</a>
      <a id="1493" href="Meta.Copattern.html#1493" class="Bound">field-tp</a> <a id="1502" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1504" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="1515" class="Symbol">(</a><a id="1516" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="1520" href="Meta.Copattern.html#1394" class="Bound">field-name</a> <a id="1531" class="Symbol">(</a><a id="1532" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="1537" href="Meta.Copattern.html#1171" class="Bound">inst-tm</a> <a id="1545" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1547" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1549" class="Symbol">))</a>

      <a id="1559" class="Comment">-- Agda will insert implicits when defining copatterns even</a>
      <a id="1625" class="Comment">-- with &#39;withExpandLast true&#39;, so we need to do implicit instantiation</a>
      <a id="1702" class="Comment">-- by hand. First, we strip off all leading implicits from the field type.</a>
      <a id="1783" class="Keyword">let</a> <a id="1787" class="Symbol">(</a><a id="1788" href="Meta.Copattern.html#1788" class="Bound">implicit-tele</a> <a id="1802" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1804" href="Meta.Copattern.html#1804" class="Bound">tp</a><a id="1806" class="Symbol">)</a> <a id="1808" class="Symbol">=</a> <a id="1810" href="Data.Reflection.Term.html#1554" class="Function">pi-impl-view</a> <a id="1823" href="Meta.Copattern.html#1493" class="Bound">field-tp</a>
          <a id="1842" href="Meta.Copattern.html#1842" class="Bound">nimplicits</a> <a id="1853" class="Symbol">=</a> <a id="1855" href="Data.List.Operations.html#829" class="Function">length</a> <a id="1862" href="Meta.Copattern.html#1788" class="Bound">implicit-tele</a>
          <a id="1886" href="Meta.Copattern.html#1886" class="Bound">clause-tele</a> <a id="1898" class="Symbol">=</a> <a id="1900" href="Meta.Copattern.html#1004" class="Bound">tele</a> <a id="1905" href="Data.List.Base.html#725" class="Function Operator">++</a> <a id="1908" href="Meta.Copattern.html#1788" class="Bound">implicit-tele</a>

      <a id="1929" class="Comment">-- Construct the pattern portion of the clause, making sure to bind</a>
      <a id="2003" class="Comment">-- all implicit variables. Note that copattern projections are always visible.</a>
      <a id="2088" class="Keyword">let</a> <a id="2092" href="Meta.Copattern.html#2092" class="Bound">pat</a> <a id="2096" class="Symbol">=</a>
            <a id="2110" href="Meta.Reflection.Base.html#4947" class="Function">tel→pats</a> <a id="2119" href="Meta.Copattern.html#1842" class="Bound">nimplicits</a> <a id="2130" href="Meta.Copattern.html#1004" class="Bound">tele</a> <a id="2135" href="Data.List.Base.html#725" class="Function Operator">++</a>
            <a id="2150" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="2154" class="Symbol">(</a><a id="2155" href="Meta.Reflection.Argument.html#345" class="Field">set-visibility</a> <a id="2170" href="Agda.Builtin.Reflection.html#2762" class="InductiveConstructor">visible</a> <a id="2178" href="Meta.Copattern.html#1383" class="Bound">field-info</a><a id="2188" class="Symbol">)</a> <a id="2190" class="Symbol">(</a><a id="2191" href="Agda.Builtin.Reflection.html#5977" class="InductiveConstructor">proj</a> <a id="2196" href="Meta.Copattern.html#1394" class="Bound">field-name</a><a id="2206" class="Symbol">)</a> <a id="2208" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
            <a id="2222" href="Meta.Reflection.Base.html#4947" class="Function">tel→pats</a> <a id="2231" class="Number">0</a> <a id="2233" href="Meta.Copattern.html#1788" class="Bound">implicit-tele</a>

      <a id="2254" class="Comment">-- Construct the body of the clause, making sure to apply all arguments</a>
      <a id="2332" class="Comment">-- bound outside the copattern match, and instantiate all implicit arguments.</a>
      <a id="2416" class="Comment">-- We also need to apply all of the implicit arguments to &#39;tm&#39;.</a>
      <a id="2486" href="Meta.Copattern.html#2486" class="Bound">zz</a> <a id="2489" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="2491" href="Meta.Reflection.Subst.html#7473" class="Function">raiseTC</a> <a id="2499" href="Meta.Copattern.html#1842" class="Bound">nimplicits</a> <a id="2510" href="Meta.Copattern.html#1171" class="Bound">inst-tm</a>
      <a id="2524" href="Meta.Copattern.html#2524" class="Bound">body</a> <a id="2529" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a>
        <a id="2539" href="Agda.Builtin.Reflection.html#9350" class="Postulate">in-context</a> <a id="2550" class="Symbol">(</a><a id="2551" href="Data.List.Base.html#866" class="Function">reverse</a> <a id="2559" href="Meta.Copattern.html#1886" class="Bound">clause-tele</a><a id="2570" class="Symbol">)</a> <a id="2572" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a>
        <a id="2582" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="2589" class="Symbol">(</a><a id="2590" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="2594" href="Meta.Copattern.html#1394" class="Bound">field-name</a> <a id="2605" class="Symbol">(</a><a id="2606" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="2611" href="Meta.Copattern.html#2486" class="Bound">zz</a> <a id="2614" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2616" href="Meta.Reflection.Base.html#5098" class="Function">tel→args</a> <a id="2625" class="Number">0</a> <a id="2627" href="Meta.Copattern.html#1788" class="Bound">implicit-tele</a><a id="2640" class="Symbol">))</a>

      <a id="2650" class="Comment">-- Construct the final clause.</a>
      <a id="2687" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="2692" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a> <a id="2694" href="Agda.Builtin.Reflection.html#6106" class="InductiveConstructor">clause</a> <a id="2701" href="Meta.Copattern.html#1886" class="Bound">clause-tele</a> <a id="2713" href="Meta.Copattern.html#2092" class="Bound">pat</a> <a id="2717" href="Meta.Copattern.html#2524" class="Bound">body</a>

  <a id="2725" class="Comment">-- Define a copattern binding, and predeclare its type if required.</a>
  <a id="2795" href="Meta.Effect.Idiom.html#533" class="Function">when</a> <a id="2800" href="Meta.Copattern.html#925" class="Bound">declare?</a> <a id="2809" class="Keyword">do</a>
    <a id="2816" href="Agda.Builtin.Reflection.html#9453" class="Postulate">declare-def</a> <a id="2828" class="Symbol">(</a><a id="2829" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="2834" href="Meta.Copattern.html#934" class="Bound">def-name</a><a id="2842" class="Symbol">)</a> <a id="2844" href="Meta.Copattern.html#946" class="Bound">tp</a>

  <a id="2850" class="Comment">-- Construct the final copattern.</a>
  <a id="2886" href="Agda.Builtin.Reflection.html#9649" class="Postulate">define-function</a> <a id="2902" href="Meta.Copattern.html#934" class="Bound">def-name</a> <a id="2911" href="Meta.Copattern.html#1306" class="Bound">clauses</a>

<a id="2920" class="Comment">-- Repack a record type.</a>
<a id="2945" class="Comment">-- Will also accept functions into record types like `A → Record`,</a>
<a id="3012" class="Comment">-- and will perform a pointwise repacking.</a>
<a id="repack-record"></a><a id="3055" href="Meta.Copattern.html#3055" class="Function">repack-record</a> <a id="3069" class="Symbol">:</a> <a id="3071" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="3076" class="Symbol">→</a> <a id="3078" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="3083" class="Symbol">→</a> <a id="3085" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="3088" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
<a id="3093" href="Meta.Copattern.html#3055" class="Function">repack-record</a> <a id="3107" href="Meta.Copattern.html#3107" class="Bound">tm</a> <a id="3110" href="Meta.Copattern.html#3110" class="Bound">tp</a> <a id="3113" class="Symbol">=</a> <a id="3115" class="Keyword">do</a>
  <a id="3120" class="Comment">-- Ensure that codomain is a record type.</a>
  <a id="3164" href="Meta.Copattern.html#3164" class="Bound">tele</a> <a id="3169" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3171" href="Meta.Copattern.html#3171" class="Bound">cod-tp</a> <a id="3178" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3180" href="Data.Reflection.Term.html#1422" class="Function">pi-view</a> <a id="3188" href="Meta.Effect.Map.html#494" class="Function Operator">&lt;$&gt;</a> <a id="3192" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="3199" href="Meta.Copattern.html#3110" class="Bound">tp</a>
  <a id="3204" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="3208" href="Meta.Copattern.html#3208" class="Bound">rec-name</a> <a id="3217" href="Meta.Copattern.html#3217" class="Bound">params</a> <a id="3224" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3226" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="3231" href="Meta.Copattern.html#3171" class="Bound">cod-tp</a>
    <a id="3242" class="Keyword">where</a> <a id="3248" class="CatchallClause Symbol">_</a> <a id="3250" class="Symbol">→</a> <a id="3252" href="Agda.Builtin.Reflection.html#8815" class="Postulate">type-error</a> <a id="3263" href="Meta.Literals.FromProduct.html#385" class="Function Operator">[</a> <a id="3265" class="String">&quot;repack-record: codomain of &quot;</a> <a id="3295" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3297" href="Data.Reflection.Error.html#191" class="InductiveConstructor">term-err</a> <a id="3306" href="Meta.Copattern.html#3110" class="Bound">tp</a> <a id="3309" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3311" class="String">&quot; is not a record type.&quot;</a> <a id="3336" href="Meta.Literals.FromProduct.html#385" class="Function Operator">]</a>

  <a id="3341" class="Comment">-- Instantiate the term with all telescope arguments to saturate it.</a>
  <a id="3412" href="Meta.Copattern.html#3412" class="Bound">inst-tm</a> <a id="3420" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3422" href="Meta.Reflection.Subst.html#7976" class="Function">apply*TC</a> <a id="3431" href="Meta.Copattern.html#3107" class="Bound">tm</a> <a id="3434" class="Symbol">(</a><a id="3435" href="Meta.Reflection.Base.html#5098" class="Function">tel→args</a> <a id="3444" class="Number">0</a> <a id="3446" href="Meta.Copattern.html#3164" class="Bound">tele</a><a id="3450" class="Symbol">)</a>

  <a id="3455" class="Comment">-- Construct fields for each projection.</a>
  <a id="3498" href="Meta.Copattern.html#3498" class="Bound">ctor</a> <a id="3503" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3505" href="Meta.Copattern.html#3505" class="Bound">fields</a> <a id="3512" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3514" href="Meta.Reflection.Signature.html#1415" class="Function">get-record-type</a> <a id="3530" href="Meta.Copattern.html#3208" class="Bound">rec-name</a>
  <a id="3541" href="Meta.Copattern.html#3541" class="Bound">args</a> <a id="3546" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3548" href="Agda.Builtin.Reflection.html#9350" class="Postulate">in-context</a> <a id="3559" class="Symbol">(</a><a id="3560" href="Data.List.Base.html#955" class="Function">reverse-fast</a> <a id="3573" href="Meta.Copattern.html#3164" class="Bound">tele</a><a id="3577" class="Symbol">)</a> <a id="3579" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a>
    <a id="3585" href="Meta.Effect.Traversable.html#396" class="Function">for</a> <a id="3589" href="Meta.Copattern.html#3505" class="Bound">fields</a> <a id="3596" class="Symbol">λ</a> <a id="3598" class="Keyword">where</a> <a id="3604" class="Symbol">(</a><a id="3605" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="3609" href="Meta.Copattern.html#3609" class="Bound">field-info</a> <a id="3620" href="Meta.Copattern.html#3620" class="Bound">field-name</a><a id="3630" class="Symbol">)</a> <a id="3632" class="Symbol">→</a>
                         <a id="3659" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="3664" href="Meta.Effect.Map.html#494" class="Function Operator">&lt;$&gt;</a> <a id="3668" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="3675" class="Symbol">(</a><a id="3676" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="3680" href="Meta.Copattern.html#3620" class="Bound">field-name</a> <a id="3691" href="Meta.Literals.FromProduct.html#385" class="Function Operator">[</a> <a id="3693" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="3698" href="Meta.Copattern.html#3412" class="Bound">inst-tm</a> <a id="3706" href="Meta.Literals.FromProduct.html#385" class="Function Operator">]</a><a id="3707" class="Symbol">)</a>

  <a id="3712" class="Comment">-- Builld a pointwise repacking.</a>
  <a id="3747" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="3752" class="Symbol">(</a><a id="3753" href="Data.Reflection.Term.html#1890" class="Function">tel→lam</a> <a id="3761" href="Meta.Copattern.html#3164" class="Bound">tele</a> <a id="3766" class="Symbol">(</a><a id="3767" href="Agda.Builtin.Reflection.html#5194" class="InductiveConstructor">con</a> <a id="3771" href="Meta.Copattern.html#3498" class="Bound">ctor</a> <a id="3776" href="Meta.Copattern.html#3541" class="Bound">args</a><a id="3780" class="Symbol">))</a>

<a id="3784" class="Comment">--------------------------------------------------------------------------------</a>
<a id="3865" class="Comment">-- Usage</a>

<a id="3875" class="Comment">{-
Write the following in a module:
&gt;  unquoteDecl copat = declare-copattern copat thing-to-be-expanded
If you wish to give the binding a type annotation, you can also use
&gt;  copat : Your-type
&gt;  unquoteDecl copat = declare-copattern copat thing-to-be-expanded
All features of non-recursive records are supported, including instance
fields and fields with implicit arguments.
These macros also allow you to lift functions &#39;A → some-record-type&#39;
into copattern definitions. Note that Agda will generate meta for
implicits before performing quotation, so we need to explicitly
bind all implicits using a lambda before quotation!
-}</a>

<a id="declare-copattern"></a><a id="4506" href="Meta.Copattern.html#4506" class="Function">declare-copattern</a> <a id="4524" class="Symbol">:</a> <a id="4526" class="Symbol">∀</a> <a id="4528" class="Symbol">{</a><a id="4529" href="Meta.Copattern.html#4529" class="Bound">ℓ</a><a id="4530" class="Symbol">}</a> <a id="4532" class="Symbol">{</a><a id="4533" href="Meta.Copattern.html#4533" class="Bound">A</a> <a id="4535" class="Symbol">:</a> <a id="4537" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="4542" href="Meta.Copattern.html#4529" class="Bound">ℓ</a><a id="4543" class="Symbol">}</a> <a id="4545" class="Symbol">→</a> <a id="4547" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4552" class="Symbol">→</a> <a id="4554" href="Meta.Copattern.html#4533" class="Bound">A</a> <a id="4556" class="Symbol">→</a> <a id="4558" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="4561" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="4563" href="Meta.Copattern.html#4506" class="Function">declare-copattern</a> <a id="4581" class="Symbol">{</a><a id="4582" class="Argument">A</a> <a id="4584" class="Symbol">=</a> <a id="4586" href="Meta.Copattern.html#4586" class="Bound">A</a><a id="4587" class="Symbol">}</a> <a id="4589" href="Meta.Copattern.html#4589" class="Bound">nm</a> <a id="4592" href="Meta.Copattern.html#4592" class="Bound">x</a> <a id="4594" class="Symbol">=</a> <a id="4596" class="Keyword">do</a>
  <a id="4601" href="Meta.Copattern.html#4601" class="Bound">`x</a> <a id="4604" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4606" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4614" href="Meta.Copattern.html#4592" class="Bound">x</a>
  <a id="4618" href="Meta.Copattern.html#4618" class="Bound">`A</a> <a id="4621" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4623" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4631" href="Meta.Copattern.html#4586" class="Bound">A</a>
  <a id="4635" href="Meta.Copattern.html#860" class="Function">make-copattern</a> <a id="4650" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="4655" href="Meta.Copattern.html#4589" class="Bound">nm</a> <a id="4658" href="Meta.Copattern.html#4601" class="Bound">`x</a> <a id="4661" href="Meta.Copattern.html#4618" class="Bound">`A</a>

<a id="define-copattern"></a><a id="4665" href="Meta.Copattern.html#4665" class="Function">define-copattern</a> <a id="4682" class="Symbol">:</a> <a id="4684" class="Symbol">∀</a> <a id="4686" class="Symbol">{</a><a id="4687" href="Meta.Copattern.html#4687" class="Bound">ℓ</a><a id="4688" class="Symbol">}</a> <a id="4690" class="Symbol">{</a><a id="4691" href="Meta.Copattern.html#4691" class="Bound">A</a> <a id="4693" class="Symbol">:</a> <a id="4695" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="4700" href="Meta.Copattern.html#4687" class="Bound">ℓ</a><a id="4701" class="Symbol">}</a> <a id="4703" class="Symbol">→</a> <a id="4705" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4710" class="Symbol">→</a> <a id="4712" href="Meta.Copattern.html#4691" class="Bound">A</a> <a id="4714" class="Symbol">→</a> <a id="4716" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="4719" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="4721" href="Meta.Copattern.html#4665" class="Function">define-copattern</a> <a id="4738" class="Symbol">{</a><a id="4739" class="Argument">A</a> <a id="4741" class="Symbol">=</a> <a id="4743" href="Meta.Copattern.html#4743" class="Bound">A</a><a id="4744" class="Symbol">}</a> <a id="4746" href="Meta.Copattern.html#4746" class="Bound">nm</a> <a id="4749" href="Meta.Copattern.html#4749" class="Bound">x</a> <a id="4751" class="Symbol">=</a> <a id="4753" class="Keyword">do</a>
  <a id="4758" href="Meta.Copattern.html#4758" class="Bound">`x</a> <a id="4761" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4763" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4771" href="Meta.Copattern.html#4749" class="Bound">x</a>
  <a id="4775" href="Meta.Copattern.html#4775" class="Bound">`A</a> <a id="4778" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4780" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4788" href="Meta.Copattern.html#4743" class="Bound">A</a>
  <a id="4792" href="Meta.Copattern.html#860" class="Function">make-copattern</a> <a id="4807" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="4813" href="Meta.Copattern.html#4746" class="Bound">nm</a> <a id="4816" href="Meta.Copattern.html#4758" class="Bound">`x</a> <a id="4819" href="Meta.Copattern.html#4775" class="Bound">`A</a>

<a id="4823" class="Comment">{-
There is a slight caveat with level-polymorphic defintions, as
they cannot be quoted into any `Type ℓ`. With this in mind,
we also provide a pair of macros that work over `Typeω` instead.
-}</a>

<a id="declare-copattern-levels"></a><a id="5018" href="Meta.Copattern.html#5018" class="Function">declare-copattern-levels</a> <a id="5043" class="Symbol">:</a> <a id="5045" class="Symbol">∀</a> <a id="5047" class="Symbol">{</a><a id="5048" href="Meta.Copattern.html#5048" class="Bound">U</a> <a id="5050" class="Symbol">:</a> <a id="5052" href="Foundations.Prim.Type.html#349" class="Primitive">Typeω</a><a id="5057" class="Symbol">}</a> <a id="5059" class="Symbol">→</a> <a id="5061" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5066" class="Symbol">→</a> <a id="5068" href="Meta.Copattern.html#5048" class="Bound">U</a> <a id="5070" class="Symbol">→</a> <a id="5072" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="5075" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="5077" href="Meta.Copattern.html#5018" class="Function">declare-copattern-levels</a> <a id="5102" href="Meta.Copattern.html#5102" class="Bound">nm</a> <a id="5105" href="Meta.Copattern.html#5105" class="Bound">A</a> <a id="5107" class="Symbol">=</a> <a id="5109" class="Keyword">do</a>
  <a id="5114" href="Meta.Copattern.html#5114" class="Bound">`A</a> <a id="5117" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5119" href="Agda.Builtin.Reflection.html#9195" class="Postulate">quoteωTC</a> <a id="5128" href="Meta.Copattern.html#5105" class="Bound">A</a>
  <a id="5132" class="Comment">-- Cannot quote things in type Typeω, but we can infer their type.</a>
  <a id="5201" href="Meta.Copattern.html#5201" class="Bound">`U</a> <a id="5204" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5206" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="5217" href="Meta.Copattern.html#5114" class="Bound">`A</a>
  <a id="5222" href="Meta.Copattern.html#860" class="Function">make-copattern</a> <a id="5237" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="5242" href="Meta.Copattern.html#5102" class="Bound">nm</a> <a id="5245" href="Meta.Copattern.html#5114" class="Bound">`A</a> <a id="5248" href="Meta.Copattern.html#5201" class="Bound">`U</a>

<a id="define-copattern-levels"></a><a id="5252" href="Meta.Copattern.html#5252" class="Function">define-copattern-levels</a> <a id="5276" class="Symbol">:</a> <a id="5278" class="Symbol">∀</a> <a id="5280" class="Symbol">{</a><a id="5281" href="Meta.Copattern.html#5281" class="Bound">U</a> <a id="5283" class="Symbol">:</a> <a id="5285" href="Foundations.Prim.Type.html#349" class="Primitive">Typeω</a><a id="5290" class="Symbol">}</a> <a id="5292" class="Symbol">→</a> <a id="5294" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5299" class="Symbol">→</a> <a id="5301" href="Meta.Copattern.html#5281" class="Bound">U</a> <a id="5303" class="Symbol">→</a> <a id="5305" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="5308" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="5310" href="Meta.Copattern.html#5252" class="Function">define-copattern-levels</a> <a id="5334" href="Meta.Copattern.html#5334" class="Bound">nm</a> <a id="5337" href="Meta.Copattern.html#5337" class="Bound">A</a> <a id="5339" class="Symbol">=</a> <a id="5341" class="Keyword">do</a>
  <a id="5346" href="Meta.Copattern.html#5346" class="Bound">`A</a> <a id="5349" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5351" href="Agda.Builtin.Reflection.html#9195" class="Postulate">quoteωTC</a> <a id="5360" href="Meta.Copattern.html#5337" class="Bound">A</a>
  <a id="5364" class="Comment">-- Cannot quote things in type Typeω, but we can infer their type.</a>
  <a id="5433" href="Meta.Copattern.html#5433" class="Bound">`U</a> <a id="5436" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5438" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="5449" href="Meta.Copattern.html#5346" class="Bound">`A</a>
  <a id="5454" href="Meta.Copattern.html#860" class="Function">make-copattern</a> <a id="5469" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="5475" href="Meta.Copattern.html#5334" class="Bound">nm</a> <a id="5478" href="Meta.Copattern.html#5346" class="Bound">`A</a> <a id="5481" href="Meta.Copattern.html#5433" class="Bound">`U</a>

<a id="5485" class="Comment">{-
Another common pattern is that two records `r : R p` and `s : R q` may contain
the same data, but they are parameterized by different values.
The `define-eta-expansion` macro will automatically construct a function
`R p → R q` that eta-expands the first record out into a copattern definition.
-}</a>

<a id="define-eta-expansion"></a><a id="5786" href="Meta.Copattern.html#5786" class="Function">define-eta-expansion</a> <a id="5807" class="Symbol">:</a> <a id="5809" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5814" class="Symbol">→</a> <a id="5816" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="5819" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="5821" href="Meta.Copattern.html#5786" class="Function">define-eta-expansion</a> <a id="5842" href="Meta.Copattern.html#5842" class="Bound">nm</a> <a id="5845" class="Symbol">=</a> <a id="5847" class="Keyword">do</a>
  <a id="5852" href="Meta.Copattern.html#5852" class="Bound">tp</a> <a id="5855" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5857" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="5864" href="Meta.Effect.Bind.html#427" class="Function Operator">=&lt;&lt;</a> <a id="5868" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="5879" class="Symbol">(</a><a id="5880" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="5884" href="Meta.Copattern.html#5842" class="Bound">nm</a> <a id="5887" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5889" class="Symbol">)</a>
  <a id="5893" class="Keyword">let</a> <a id="5897" href="Meta.Copattern.html#5897" class="Bound">tele</a> <a id="5902" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5904" class="Symbol">_</a> <a id="5906" class="Symbol">=</a> <a id="5908" href="Data.Reflection.Term.html#1422" class="Function">pi-view</a> <a id="5916" href="Meta.Copattern.html#5852" class="Bound">tp</a>
  <a id="5921" class="Keyword">let</a> <a id="5925" href="Meta.Copattern.html#5925" class="Bound">tm</a> <a id="5928" class="Symbol">=</a> <a id="5930" href="Data.Reflection.Term.html#1890" class="Function">tel→lam</a> <a id="5938" href="Meta.Copattern.html#5897" class="Bound">tele</a> <a id="5943" class="Symbol">(</a><a id="5944" href="Agda.Builtin.Reflection.html#5138" class="InductiveConstructor">var</a> <a id="5948" class="Number">0</a> <a id="5950" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5952" class="Symbol">)</a>
  <a id="5956" href="Meta.Copattern.html#860" class="Function">make-copattern</a> <a id="5971" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="5977" href="Meta.Copattern.html#5842" class="Bound">nm</a> <a id="5980" href="Meta.Copattern.html#5925" class="Bound">tm</a> <a id="5983" href="Meta.Copattern.html#5852" class="Bound">tp</a>

<a id="5987" class="Comment">--------------------------------------------------------------------------------</a>
<a id="6068" class="Comment">-- Tests</a>

<a id="6078" class="Keyword">private</a> <a id="6086" class="Keyword">module</a> <a id="Test"></a><a id="6093" href="Meta.Copattern.html#6093" class="Module">Test</a> <a id="6098" class="Keyword">where</a>
  <a id="6106" class="Comment">-- Record type that uses all interesting features.</a>
  <a id="6159" class="Keyword">record</a> <a id="Test.Record"></a><a id="6166" href="Meta.Copattern.html#6166" class="Record">Record</a> <a id="6173" class="Symbol">{</a><a id="6174" href="Meta.Copattern.html#6174" class="Bound">ℓ</a><a id="6175" class="Symbol">}</a> <a id="6177" class="Symbol">(</a><a id="6178" href="Meta.Copattern.html#6178" class="Bound">A</a> <a id="6180" class="Symbol">:</a> <a id="6182" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="6187" href="Meta.Copattern.html#6174" class="Bound">ℓ</a><a id="6188" class="Symbol">)</a> <a id="6190" class="Symbol">:</a> <a id="6192" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="6197" href="Meta.Copattern.html#6174" class="Bound">ℓ</a> <a id="6199" class="Keyword">where</a>
    <a id="6209" class="Keyword">no-eta-equality</a>
    <a id="6229" class="Keyword">constructor</a> <a id="Test.mk"></a><a id="6241" href="Meta.Copattern.html#6241" class="InductiveConstructor">mk</a>
    <a id="6248" class="Keyword">field</a>
      <a id="6260" class="Symbol">⦃</a> <a id="Test.Record.c"></a><a id="6262" href="Meta.Copattern.html#6262" class="Field">c</a> <a id="6264" class="Symbol">⦄</a> <a id="6266" class="Symbol">:</a> <a id="6268" href="Meta.Copattern.html#6178" class="Bound">A</a>
      <a id="6276" class="Symbol">{</a> <a id="Test.Record.f"></a><a id="6278" href="Meta.Copattern.html#6278" class="Field">f</a> <a id="6280" class="Symbol">}</a> <a id="6282" class="Symbol">:</a> <a id="6284" href="Meta.Copattern.html#6178" class="Bound">A</a> <a id="6286" class="Symbol">→</a> <a id="6288" href="Meta.Copattern.html#6178" class="Bound">A</a>
      <a id="Test.Record.const′"></a><a id="6296" href="Meta.Copattern.html#6296" class="Field">const′</a> <a id="6303" class="Symbol">:</a> <a id="6305" class="Symbol">∀</a> <a id="6307" class="Symbol">{</a><a id="6308" href="Meta.Copattern.html#6308" class="Bound">x</a><a id="6309" class="Symbol">}</a> <a id="6311" class="Symbol">→</a> <a id="6313" href="Meta.Copattern.html#6278" class="Field">f</a> <a id="6315" href="Meta.Copattern.html#6308" class="Bound">x</a> <a id="6317" href="Foundations.Prim.Kan.html#1264" class="Function Operator">＝</a> <a id="6319" href="Meta.Copattern.html#6262" class="Field">c</a>

  <a id="6324" class="Comment">-- Record created via a constructor.</a>
  <a id="Test.via-ctor"></a><a id="6363" href="Meta.Copattern.html#6363" class="Function">via-ctor</a> <a id="6372" class="Symbol">:</a> <a id="6374" href="Meta.Copattern.html#6166" class="Record">Record</a> <a id="6381" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="6385" href="Meta.Copattern.html#6363" class="Function">via-ctor</a> <a id="6394" class="Symbol">=</a> <a id="6396" href="Meta.Copattern.html#6241" class="InductiveConstructor">mk</a> <a id="6399" class="Symbol">⦃</a> <a id="6401" class="Argument">c</a> <a id="6403" class="Symbol">=</a> <a id="6405" class="Number">0</a> <a id="6407" class="Symbol">⦄</a> <a id="6409" class="Symbol">{</a><a id="6410" class="Argument">f</a> <a id="6412" class="Symbol">=</a> <a id="6414" class="Symbol">λ</a> <a id="6416" href="Meta.Copattern.html#6416" class="Bound">_</a> <a id="6418" class="Symbol">→</a> <a id="6420" class="Number">0</a><a id="6421" class="Symbol">}</a> <a id="6423" href="Foundations.Correspondences.Binary.Reflexive.html#337" class="Field">refl</a>

  <a id="6431" class="Comment">-- Both macros work.</a>
  <a id="6454" class="Keyword">unquoteDecl</a> <a id="Test.copat-decl-via-ctor"></a><a id="6466" href="Meta.Copattern.html#6466" class="Function">copat-decl-via-ctor</a> <a id="6486" class="Symbol">=</a> <a id="6488" href="Meta.Copattern.html#4506" class="Function">declare-copattern</a> <a id="6506" href="Meta.Copattern.html#6466" class="Function">copat-decl-via-ctor</a> <a id="6526" href="Meta.Copattern.html#6363" class="Function">via-ctor</a>

  <a id="Test.copat-def-via-ctor"></a><a id="6538" href="Meta.Copattern.html#6538" class="Function">copat-def-via-ctor</a> <a id="6557" class="Symbol">:</a> <a id="6559" href="Meta.Copattern.html#6166" class="Record">Record</a> <a id="6566" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="6570" class="Keyword">unquoteDef</a> <a id="6581" href="Meta.Copattern.html#6538" class="Function">copat-def-via-ctor</a> <a id="6600" class="Symbol">=</a> <a id="6602" href="Meta.Copattern.html#4665" class="Function">define-copattern</a> <a id="6619" href="Meta.Copattern.html#6538" class="Function">copat-def-via-ctor</a> <a id="6638" href="Meta.Copattern.html#6363" class="Function">via-ctor</a>

  <a id="6650" class="Comment">-- Record created by a function.</a>
  <a id="6685" class="Keyword">module</a> <a id="6692" href="Meta.Copattern.html#6692" class="Module">_</a> <a id="6694" class="Symbol">(</a><a id="6695" href="Meta.Copattern.html#6695" class="Bound">r</a> <a id="6697" class="Symbol">:</a> <a id="6699" href="Meta.Copattern.html#6166" class="Record">Record</a> <a id="6706" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="6707" class="Symbol">)</a> <a id="6709" class="Keyword">where</a>
    <a id="6719" class="Keyword">open</a> <a id="6724" href="Meta.Copattern.html#6166" class="Module">Record</a> <a id="6731" href="Meta.Copattern.html#6695" class="Bound">r</a>
    <a id="6737" href="Meta.Copattern.html#6737" class="Function">via-function</a> <a id="6750" class="Symbol">:</a> <a id="6752" href="Meta.Copattern.html#6166" class="Record">Record</a> <a id="6759" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
    <a id="6765" href="Meta.Copattern.html#6737" class="Function">via-function</a> <a id="6778" class="Symbol">.</a><a id="6779" href="Meta.Copattern.html#6262" class="Field">c</a> <a id="6781" class="Symbol">=</a> <a id="6783" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6787" href="Meta.Copattern.html#6262" class="Field">c</a>
    <a id="6793" href="Meta.Copattern.html#6737" class="Function">via-function</a> <a id="6806" class="Symbol">.</a><a id="6807" href="Meta.Copattern.html#6278" class="Field">f</a> <a id="6809" class="Symbol">=</a> <a id="6811" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6815" href="Foundations.Pi.Base.html#2101" class="Function Operator">∘</a> <a id="6817" href="Meta.Copattern.html#6278" class="Field">f</a>
    <a id="6823" href="Meta.Copattern.html#6737" class="Function">via-function</a> <a id="6836" class="Symbol">.</a><a id="6837" href="Meta.Copattern.html#6296" class="Field">const′</a> <a id="6844" class="Symbol">=</a> <a id="6846" href="Foundations.Prim.Kan.html#1724" class="Function">ap</a> <a id="6849" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6853" href="Meta.Copattern.html#6296" class="Field">const′</a>

  <a id="6863" class="Comment">-- Also works when applied to the result of a function.</a>
  <a id="6921" class="Keyword">unquoteDecl</a> <a id="Test.copat-decl-via-function"></a><a id="6933" href="Meta.Copattern.html#6933" class="Function">copat-decl-via-function</a> <a id="6957" class="Symbol">=</a> <a id="6959" href="Meta.Copattern.html#4506" class="Function">declare-copattern</a> <a id="6977" href="Meta.Copattern.html#6933" class="Function">copat-decl-via-function</a> <a id="7001" class="Symbol">(</a><a id="7002" href="Meta.Copattern.html#6737" class="Function">via-function</a> <a id="7015" href="Meta.Copattern.html#6363" class="Function">via-ctor</a><a id="7023" class="Symbol">)</a>

  <a id="7028" class="Comment">-- Test to see how we handle unused parameters.</a>
  <a id="7078" class="Keyword">record</a> <a id="Test.Unused"></a><a id="7085" href="Meta.Copattern.html#7085" class="Record">Unused</a> <a id="7092" class="Symbol">(</a><a id="7093" href="Meta.Copattern.html#7093" class="Bound">n</a> <a id="7095" class="Symbol">:</a> <a id="7097" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="7098" class="Symbol">)</a> <a id="7100" class="Symbol">:</a> <a id="7102" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7107" class="Keyword">where</a>
    <a id="7117" class="Keyword">field</a>
      <a id="Test.Unused.actual"></a><a id="7129" href="Meta.Copattern.html#7129" class="Field">actual</a> <a id="7136" class="Symbol">:</a> <a id="7138" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

  <a id="Test.zero-unused-param"></a><a id="7143" href="Meta.Copattern.html#7143" class="Function">zero-unused-param</a> <a id="7161" class="Symbol">:</a> <a id="7163" href="Meta.Copattern.html#7085" class="Record">Unused</a> <a id="7170" class="Number">0</a>
  <a id="7174" href="Meta.Copattern.html#7143" class="Function">zero-unused-param</a> <a id="7192" class="Symbol">=</a> <a id="7194" class="Keyword">record</a> <a id="7201" class="Symbol">{</a> <a id="7203" href="Meta.Copattern.html#7129" class="Field">actual</a> <a id="7210" class="Symbol">=</a> <a id="7212" class="Number">0</a> <a id="7214" class="Symbol">}</a>

  <a id="Test.one-unused-param"></a><a id="7219" href="Meta.Copattern.html#7219" class="Function">one-unused-param</a> <a id="7236" class="Symbol">:</a> <a id="7238" class="Symbol">∀</a> <a id="7240" class="Symbol">{</a><a id="7241" href="Meta.Copattern.html#7241" class="Bound">n</a><a id="7242" class="Symbol">}</a> <a id="7244" class="Symbol">→</a> <a id="7246" href="Meta.Copattern.html#7085" class="Record">Unused</a> <a id="7253" href="Meta.Copattern.html#7241" class="Bound">n</a>
  <a id="7257" class="Keyword">unquoteDef</a> <a id="7268" href="Meta.Copattern.html#7219" class="Function">one-unused-param</a> <a id="7285" class="Symbol">=</a> <a id="7287" href="Meta.Copattern.html#4665" class="Function">define-copattern</a> <a id="7304" href="Meta.Copattern.html#7219" class="Function">one-unused-param</a> <a id="7321" href="Meta.Copattern.html#7143" class="Function">zero-unused-param</a>

  <a id="7342" class="Comment">-- Functions into records that are universe polymorphic</a>
  <a id="Test.neat"></a><a id="7400" href="Meta.Copattern.html#7400" class="Function">neat</a> <a id="7405" class="Symbol">:</a> <a id="7407" class="Symbol">∀</a> <a id="7409" class="Symbol">{</a><a id="7410" href="Meta.Copattern.html#7410" class="Bound">ℓ</a><a id="7411" class="Symbol">}</a> <a id="7413" class="Symbol">{</a><a id="7414" href="Meta.Copattern.html#7414" class="Bound">A</a> <a id="7416" class="Symbol">:</a> <a id="7418" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7423" href="Meta.Copattern.html#7410" class="Bound">ℓ</a><a id="7424" class="Symbol">}</a> <a id="7426" class="Symbol">→</a> <a id="7428" href="Meta.Copattern.html#7414" class="Bound">A</a> <a id="7430" class="Symbol">→</a> <a id="7432" href="Meta.Copattern.html#6166" class="Record">Record</a> <a id="7439" href="Meta.Copattern.html#7414" class="Bound">A</a>
  <a id="7443" href="Meta.Copattern.html#7400" class="Function">neat</a> <a id="7448" href="Meta.Copattern.html#7448" class="Bound">a</a> <a id="7450" class="Symbol">.</a><a id="7451" href="Meta.Copattern.html#6262" class="Field">Record.c</a> <a id="7460" class="Symbol">=</a> <a id="7462" href="Meta.Copattern.html#7448" class="Bound">a</a>
  <a id="7466" href="Meta.Copattern.html#7400" class="Function">neat</a> <a id="7471" href="Meta.Copattern.html#7471" class="Bound">a</a> <a id="7473" class="Symbol">.</a><a id="7474" href="Meta.Copattern.html#6278" class="Field">Record.f</a> <a id="7483" class="Symbol">_</a> <a id="7485" class="Symbol">=</a> <a id="7487" href="Meta.Copattern.html#7471" class="Bound">a</a>
  <a id="7491" href="Meta.Copattern.html#7400" class="Function">neat</a> <a id="7496" href="Meta.Copattern.html#7496" class="Bound">a</a> <a id="7498" class="Symbol">.</a><a id="7499" href="Meta.Copattern.html#6296" class="Field">Record.const′</a> <a id="7513" class="Symbol">=</a> <a id="7515" href="Foundations.Correspondences.Binary.Reflexive.html#337" class="Field">refl</a>

  <a id="Test.cool"></a><a id="7523" href="Meta.Copattern.html#7523" class="Function">cool</a> <a id="7528" class="Symbol">:</a> <a id="7530" class="Symbol">∀</a> <a id="7532" class="Symbol">{</a><a id="7533" href="Meta.Copattern.html#7533" class="Bound">ℓ</a><a id="7534" class="Symbol">}</a> <a id="7536" class="Symbol">{</a><a id="7537" href="Meta.Copattern.html#7537" class="Bound">A</a> <a id="7539" class="Symbol">:</a> <a id="7541" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7546" href="Meta.Copattern.html#7533" class="Bound">ℓ</a><a id="7547" class="Symbol">}</a> <a id="7549" class="Symbol">→</a> <a id="7551" href="Meta.Copattern.html#7537" class="Bound">A</a> <a id="7553" class="Symbol">→</a> <a id="7555" href="Meta.Copattern.html#6166" class="Record">Record</a> <a id="7562" href="Meta.Copattern.html#7537" class="Bound">A</a>
  <a id="7566" class="Keyword">unquoteDef</a> <a id="7577" href="Meta.Copattern.html#7523" class="Function">cool</a> <a id="7582" class="Symbol">=</a> <a id="7584" href="Meta.Copattern.html#5252" class="Function">define-copattern-levels</a> <a id="7608" href="Meta.Copattern.html#7523" class="Function">cool</a> <a id="7613" class="Symbol">λ</a> <a id="7615" class="Symbol">{</a><a id="7616" href="Meta.Copattern.html#7616" class="Bound">ℓ</a><a id="7617" class="Symbol">}</a> <a id="7619" class="Symbol">{</a><a id="7620" href="Meta.Copattern.html#7620" class="Bound">A</a> <a id="7622" class="Symbol">:</a> <a id="7624" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7629" href="Meta.Copattern.html#7616" class="Bound">ℓ</a><a id="7630" class="Symbol">}</a> <a id="7632" class="Symbol">→</a> <a id="7634" href="Meta.Copattern.html#7400" class="Function">neat</a>

  <a id="7642" class="Comment">-- Eta-expanders</a>
  <a id="Test.expander"></a><a id="7661" href="Meta.Copattern.html#7661" class="Function">expander</a> <a id="7670" class="Symbol">:</a> <a id="7672" class="Symbol">∀</a> <a id="7674" class="Symbol">{</a><a id="7675" href="Meta.Copattern.html#7675" class="Bound">m</a> <a id="7677" href="Meta.Copattern.html#7677" class="Bound">n</a> <a id="7679" class="Symbol">:</a> <a id="7681" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="7682" class="Symbol">}</a> <a id="7684" class="Symbol">→</a> <a id="7686" href="Meta.Copattern.html#7085" class="Record">Unused</a> <a id="7693" href="Meta.Copattern.html#7675" class="Bound">m</a> <a id="7695" class="Symbol">→</a> <a id="7697" href="Meta.Copattern.html#7085" class="Record">Unused</a> <a id="7704" href="Meta.Copattern.html#7677" class="Bound">n</a>
  <a id="7708" class="Keyword">unquoteDef</a> <a id="7719" href="Meta.Copattern.html#7661" class="Function">expander</a> <a id="7728" class="Symbol">=</a> <a id="7730" href="Meta.Copattern.html#5786" class="Function">define-eta-expansion</a> <a id="7751" href="Meta.Copattern.html#7661" class="Function">expander</a>
</pre></body></html>