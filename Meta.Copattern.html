<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Meta.Copattern</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">-- Reed Mullanix 2024</a>
<a id="23" class="Symbol">{-#</a> <a id="27" class="Keyword">OPTIONS</a> <a id="35" class="Pragma">--safe</a> <a id="42" class="Symbol">#-}</a>
<a id="46" class="Keyword">module</a> <a id="53" href="Meta.Copattern.html" class="Module">Meta.Copattern</a> <a id="68" class="Keyword">where</a>

<a id="75" class="Keyword">open</a> <a id="80" class="Keyword">import</a> <a id="87" href="Foundations.Prelude.html" class="Module">Foundations.Prelude</a>

<a id="108" class="Keyword">open</a> <a id="113" class="Keyword">import</a> <a id="120" href="Meta.Effect.Traversable.html" class="Module">Meta.Effect.Traversable</a>
<a id="144" class="Keyword">open</a> <a id="149" class="Keyword">import</a> <a id="156" href="Meta.Reflection.Argument.html" class="Module">Meta.Reflection.Argument</a>
<a id="181" class="Keyword">open</a> <a id="186" class="Keyword">import</a> <a id="193" href="Meta.Reflection.Base.html" class="Module">Meta.Reflection.Base</a>
<a id="214" class="Keyword">open</a> <a id="219" class="Keyword">import</a> <a id="226" href="Meta.Reflection.Signature.html" class="Module">Meta.Reflection.Signature</a>
<a id="252" class="Keyword">open</a> <a id="257" class="Keyword">import</a> <a id="264" href="Meta.Reflection.Subst.html" class="Module">Meta.Reflection.Subst</a>

<a id="287" class="Keyword">open</a> <a id="292" class="Keyword">import</a> <a id="299" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="314" class="Keyword">open</a> <a id="319" class="Keyword">import</a> <a id="326" href="Data.List.Base.html" class="Module">Data.List.Base</a>
<a id="341" class="Keyword">open</a> <a id="346" class="Keyword">import</a> <a id="353" href="Data.List.Operations.html" class="Module">Data.List.Operations</a>
<a id="374" class="Keyword">open</a> <a id="379" class="Keyword">import</a> <a id="386" href="Data.List.Instances.FromProduct.html" class="Module">Data.List.Instances.FromProduct</a>
<a id="418" class="Keyword">open</a> <a id="423" class="Keyword">import</a> <a id="430" href="Data.List.Instances.Traversable.html" class="Module">Data.List.Instances.Traversable</a>
<a id="462" class="Keyword">open</a> <a id="467" class="Keyword">import</a> <a id="474" href="Data.Reflection.Argument.html" class="Module">Data.Reflection.Argument</a>
<a id="499" class="Keyword">open</a> <a id="504" class="Keyword">import</a> <a id="511" href="Data.Reflection.Error.html" class="Module">Data.Reflection.Error</a>
<a id="533" class="Keyword">open</a> <a id="538" class="Keyword">import</a> <a id="545" href="Data.Reflection.Instances.FromString.html" class="Module">Data.Reflection.Instances.FromString</a>
<a id="582" class="Keyword">open</a> <a id="587" class="Keyword">import</a> <a id="594" href="Data.Reflection.Name.html" class="Module">Data.Reflection.Name</a>
<a id="615" class="Keyword">open</a> <a id="620" class="Keyword">import</a> <a id="627" href="Data.Reflection.Term.html" class="Module">Data.Reflection.Term</a>

<a id="649" class="Comment">--------------------------------------------------------------------------------</a>
<a id="730" class="Comment">-- Macros for manipulating copattern definitions.</a>

<a id="781" class="Comment">-- Make a top-level copattern binding for an existing record.</a>
<a id="make-copattern"></a><a id="843" href="Meta.Copattern.html#843" class="Function">make-copattern</a> <a id="858" class="Symbol">:</a> <a id="860" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="865" class="Symbol">→</a> <a id="867" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="872" class="Symbol">→</a> <a id="874" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="879" class="Symbol">→</a> <a id="881" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="886" class="Symbol">→</a> <a id="888" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="891" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="893" href="Meta.Copattern.html#843" class="Function">make-copattern</a> <a id="908" href="Meta.Copattern.html#908" class="Bound">declare?</a> <a id="917" href="Meta.Copattern.html#917" class="Bound">def-name</a> <a id="926" href="Meta.Copattern.html#926" class="Bound">tm</a> <a id="929" href="Meta.Copattern.html#929" class="Bound">tp</a> <a id="932" class="Symbol">=</a> <a id="934" class="Keyword">do</a>
  <a id="939" class="Comment">-- Ensure that codomain is a record type.</a>
  <a id="983" class="Keyword">let</a> <a id="987" href="Meta.Copattern.html#987" class="Bound">tele</a> <a id="992" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="994" href="Meta.Copattern.html#994" class="Bound">cod-tp</a> <a id="1001" class="Symbol">=</a> <a id="1003" href="Data.Reflection.Term.html#1405" class="Function">pi-view</a> <a id="1011" href="Meta.Copattern.html#929" class="Bound">tp</a>
  <a id="1016" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="1020" href="Meta.Copattern.html#1020" class="Bound">rec-name</a> <a id="1029" href="Meta.Copattern.html#1029" class="Bound">params</a> <a id="1036" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1038" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="1043" href="Meta.Copattern.html#994" class="Bound">cod-tp</a>
    <a id="1054" class="Keyword">where</a> <a id="1060" class="CatchallClause Symbol">_</a> <a id="1062" class="Symbol">→</a> <a id="1064" href="Agda.Builtin.Reflection.html#8815" class="Postulate">type-error</a> <a id="1075" href="Meta.Literals.FromProduct.html#385" class="Function Operator">[</a> <a id="1077" class="String">&quot;make-copattern: codomain of &quot;</a> <a id="1108" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1110" href="Data.Reflection.Error.html#191" class="InductiveConstructor">term-err</a> <a id="1119" href="Meta.Copattern.html#929" class="Bound">tp</a> <a id="1122" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1124" class="String">&quot; is not a record type.&quot;</a> <a id="1149" href="Meta.Literals.FromProduct.html#385" class="Function Operator">]</a>

  <a id="1154" href="Meta.Copattern.html#1154" class="Bound">inst-tm</a> <a id="1162" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1164" href="Meta.Reflection.Subst.html#7959" class="Function">apply*TC</a> <a id="1173" href="Meta.Copattern.html#926" class="Bound">tm</a> <a id="1176" class="Symbol">(</a><a id="1177" href="Meta.Reflection.Base.html#5081" class="Function">tel→args</a> <a id="1186" class="Number">0</a> <a id="1188" href="Meta.Copattern.html#987" class="Bound">tele</a><a id="1192" class="Symbol">)</a>

  <a id="1197" class="Comment">-- Construct copattern clauses for each field.</a>
  <a id="1246" href="Meta.Copattern.html#1246" class="Bound">ctor</a> <a id="1251" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1253" href="Meta.Copattern.html#1253" class="Bound">fields</a> <a id="1260" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1262" href="Meta.Reflection.Signature.html#1398" class="Function">get-record-type</a> <a id="1278" href="Meta.Copattern.html#1020" class="Bound">rec-name</a>
  <a id="1289" href="Meta.Copattern.html#1289" class="Bound">clauses</a> <a id="1297" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a>
    <a id="1303" href="Agda.Builtin.Reflection.html#9350" class="Postulate">in-context</a> <a id="1314" class="Symbol">(</a><a id="1315" href="Data.List.Base.html#938" class="Function">reverse-fast</a> <a id="1328" href="Meta.Copattern.html#987" class="Bound">tele</a><a id="1332" class="Symbol">)</a> <a id="1334" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a>
      <a id="1342" href="Meta.Effect.Traversable.html#396" class="Function">for</a> <a id="1346" href="Meta.Copattern.html#1253" class="Bound">fields</a> <a id="1353" class="Symbol">λ</a> <a id="1355" class="Keyword">where</a> <a id="1361" class="Symbol">(</a><a id="1362" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="1366" href="Meta.Copattern.html#1366" class="Bound">field-info</a> <a id="1377" href="Meta.Copattern.html#1377" class="Bound">field-name</a><a id="1387" class="Symbol">)</a> <a id="1389" class="Symbol">→</a> <a id="1391" class="Keyword">do</a>
      <a id="1400" class="Comment">-- Infer the type of the field with all known arguments instantiated.</a>
      <a id="1476" href="Meta.Copattern.html#1476" class="Bound">field-tp</a> <a id="1485" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="1487" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="1498" class="Symbol">(</a><a id="1499" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="1503" href="Meta.Copattern.html#1377" class="Bound">field-name</a> <a id="1514" class="Symbol">(</a><a id="1515" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="1520" href="Meta.Copattern.html#1154" class="Bound">inst-tm</a> <a id="1528" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1530" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1532" class="Symbol">))</a>

      <a id="1542" class="Comment">-- Agda will insert implicits when defining copatterns even</a>
      <a id="1608" class="Comment">-- with &#39;withExpandLast true&#39;, so we need to do implicit instantiation</a>
      <a id="1685" class="Comment">-- by hand. First, we strip off all leading implicits from the field type.</a>
      <a id="1766" class="Keyword">let</a> <a id="1770" class="Symbol">(</a><a id="1771" href="Meta.Copattern.html#1771" class="Bound">implicit-tele</a> <a id="1785" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1787" href="Meta.Copattern.html#1787" class="Bound">tp</a><a id="1789" class="Symbol">)</a> <a id="1791" class="Symbol">=</a> <a id="1793" href="Data.Reflection.Term.html#1537" class="Function">pi-impl-view</a> <a id="1806" href="Meta.Copattern.html#1476" class="Bound">field-tp</a>
          <a id="1825" href="Meta.Copattern.html#1825" class="Bound">nimplicits</a> <a id="1836" class="Symbol">=</a> <a id="1838" href="Data.List.Operations.html#812" class="Function">length</a> <a id="1845" href="Meta.Copattern.html#1771" class="Bound">implicit-tele</a>
          <a id="1869" href="Meta.Copattern.html#1869" class="Bound">clause-tele</a> <a id="1881" class="Symbol">=</a> <a id="1883" href="Meta.Copattern.html#987" class="Bound">tele</a> <a id="1888" href="Data.List.Base.html#708" class="Function Operator">++</a> <a id="1891" href="Meta.Copattern.html#1771" class="Bound">implicit-tele</a>

      <a id="1912" class="Comment">-- Construct the pattern portion of the clause, making sure to bind</a>
      <a id="1986" class="Comment">-- all implicit variables. Note that copattern projections are always visible.</a>
      <a id="2071" class="Keyword">let</a> <a id="2075" href="Meta.Copattern.html#2075" class="Bound">pat</a> <a id="2079" class="Symbol">=</a>
            <a id="2093" href="Meta.Reflection.Base.html#4930" class="Function">tel→pats</a> <a id="2102" href="Meta.Copattern.html#1825" class="Bound">nimplicits</a> <a id="2113" href="Meta.Copattern.html#987" class="Bound">tele</a> <a id="2118" href="Data.List.Base.html#708" class="Function Operator">++</a>
            <a id="2133" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="2137" class="Symbol">(</a><a id="2138" href="Meta.Reflection.Argument.html#345" class="Field">set-visibility</a> <a id="2153" href="Agda.Builtin.Reflection.html#2762" class="InductiveConstructor">visible</a> <a id="2161" href="Meta.Copattern.html#1366" class="Bound">field-info</a><a id="2171" class="Symbol">)</a> <a id="2173" class="Symbol">(</a><a id="2174" href="Agda.Builtin.Reflection.html#5977" class="InductiveConstructor">proj</a> <a id="2179" href="Meta.Copattern.html#1377" class="Bound">field-name</a><a id="2189" class="Symbol">)</a> <a id="2191" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a>
            <a id="2205" href="Meta.Reflection.Base.html#4930" class="Function">tel→pats</a> <a id="2214" class="Number">0</a> <a id="2216" href="Meta.Copattern.html#1771" class="Bound">implicit-tele</a>

      <a id="2237" class="Comment">-- Construct the body of the clause, making sure to apply all arguments</a>
      <a id="2315" class="Comment">-- bound outside the copattern match, and instantiate all implicit arguments.</a>
      <a id="2399" class="Comment">-- We also need to apply all of the implicit arguments to &#39;tm&#39;.</a>
      <a id="2469" href="Meta.Copattern.html#2469" class="Bound">zz</a> <a id="2472" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="2474" href="Meta.Reflection.Subst.html#7456" class="Function">raiseTC</a> <a id="2482" href="Meta.Copattern.html#1825" class="Bound">nimplicits</a> <a id="2493" href="Meta.Copattern.html#1154" class="Bound">inst-tm</a>
      <a id="2507" href="Meta.Copattern.html#2507" class="Bound">body</a> <a id="2512" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a>
        <a id="2522" href="Agda.Builtin.Reflection.html#9350" class="Postulate">in-context</a> <a id="2533" class="Symbol">(</a><a id="2534" href="Data.List.Base.html#849" class="Function">reverse</a> <a id="2542" href="Meta.Copattern.html#1869" class="Bound">clause-tele</a><a id="2553" class="Symbol">)</a> <a id="2555" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a>
        <a id="2565" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="2572" class="Symbol">(</a><a id="2573" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="2577" href="Meta.Copattern.html#1377" class="Bound">field-name</a> <a id="2588" class="Symbol">(</a><a id="2589" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="2594" href="Meta.Copattern.html#2469" class="Bound">zz</a> <a id="2597" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="2599" href="Meta.Reflection.Base.html#5081" class="Function">tel→args</a> <a id="2608" class="Number">0</a> <a id="2610" href="Meta.Copattern.html#1771" class="Bound">implicit-tele</a><a id="2623" class="Symbol">))</a>

      <a id="2633" class="Comment">-- Construct the final clause.</a>
      <a id="2670" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="2675" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a> <a id="2677" href="Agda.Builtin.Reflection.html#6106" class="InductiveConstructor">clause</a> <a id="2684" href="Meta.Copattern.html#1869" class="Bound">clause-tele</a> <a id="2696" href="Meta.Copattern.html#2075" class="Bound">pat</a> <a id="2700" href="Meta.Copattern.html#2507" class="Bound">body</a>

  <a id="2708" class="Comment">-- Define a copattern binding, and predeclare its type if required.</a>
  <a id="2778" href="Meta.Effect.Idiom.html#533" class="Function">when</a> <a id="2783" href="Meta.Copattern.html#908" class="Bound">declare?</a> <a id="2792" class="Keyword">do</a>
    <a id="2799" href="Agda.Builtin.Reflection.html#9453" class="Postulate">declare-def</a> <a id="2811" class="Symbol">(</a><a id="2812" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="2817" href="Meta.Copattern.html#917" class="Bound">def-name</a><a id="2825" class="Symbol">)</a> <a id="2827" href="Meta.Copattern.html#929" class="Bound">tp</a>

  <a id="2833" class="Comment">-- Construct the final copattern.</a>
  <a id="2869" href="Agda.Builtin.Reflection.html#9649" class="Postulate">define-function</a> <a id="2885" href="Meta.Copattern.html#917" class="Bound">def-name</a> <a id="2894" href="Meta.Copattern.html#1289" class="Bound">clauses</a>

<a id="2903" class="Comment">-- Repack a record type.</a>
<a id="2928" class="Comment">-- Will also accept functions into record types like `A → Record`,</a>
<a id="2995" class="Comment">-- and will perform a pointwise repacking.</a>
<a id="repack-record"></a><a id="3038" href="Meta.Copattern.html#3038" class="Function">repack-record</a> <a id="3052" class="Symbol">:</a> <a id="3054" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="3059" class="Symbol">→</a> <a id="3061" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a> <a id="3066" class="Symbol">→</a> <a id="3068" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="3071" href="Agda.Builtin.Reflection.html#4993" class="Datatype">Term</a>
<a id="3076" href="Meta.Copattern.html#3038" class="Function">repack-record</a> <a id="3090" href="Meta.Copattern.html#3090" class="Bound">tm</a> <a id="3093" href="Meta.Copattern.html#3093" class="Bound">tp</a> <a id="3096" class="Symbol">=</a> <a id="3098" class="Keyword">do</a>
  <a id="3103" class="Comment">-- Ensure that codomain is a record type.</a>
  <a id="3147" href="Meta.Copattern.html#3147" class="Bound">tele</a> <a id="3152" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3154" href="Meta.Copattern.html#3154" class="Bound">cod-tp</a> <a id="3161" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3163" href="Data.Reflection.Term.html#1405" class="Function">pi-view</a> <a id="3171" href="Meta.Effect.Map.html#494" class="Function Operator">&lt;$&gt;</a> <a id="3175" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="3182" href="Meta.Copattern.html#3093" class="Bound">tp</a>
  <a id="3187" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="3191" href="Meta.Copattern.html#3191" class="Bound">rec-name</a> <a id="3200" href="Meta.Copattern.html#3200" class="Bound">params</a> <a id="3207" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3209" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="3214" href="Meta.Copattern.html#3154" class="Bound">cod-tp</a>
    <a id="3225" class="Keyword">where</a> <a id="3231" class="CatchallClause Symbol">_</a> <a id="3233" class="Symbol">→</a> <a id="3235" href="Agda.Builtin.Reflection.html#8815" class="Postulate">type-error</a> <a id="3246" href="Meta.Literals.FromProduct.html#385" class="Function Operator">[</a> <a id="3248" class="String">&quot;repack-record: codomain of &quot;</a> <a id="3278" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3280" href="Data.Reflection.Error.html#191" class="InductiveConstructor">term-err</a> <a id="3289" href="Meta.Copattern.html#3093" class="Bound">tp</a> <a id="3292" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3294" class="String">&quot; is not a record type.&quot;</a> <a id="3319" href="Meta.Literals.FromProduct.html#385" class="Function Operator">]</a>

  <a id="3324" class="Comment">-- Instantiate the term with all telescope arguments to saturate it.</a>
  <a id="3395" href="Meta.Copattern.html#3395" class="Bound">inst-tm</a> <a id="3403" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3405" href="Meta.Reflection.Subst.html#7959" class="Function">apply*TC</a> <a id="3414" href="Meta.Copattern.html#3090" class="Bound">tm</a> <a id="3417" class="Symbol">(</a><a id="3418" href="Meta.Reflection.Base.html#5081" class="Function">tel→args</a> <a id="3427" class="Number">0</a> <a id="3429" href="Meta.Copattern.html#3147" class="Bound">tele</a><a id="3433" class="Symbol">)</a>

  <a id="3438" class="Comment">-- Construct fields for each projection.</a>
  <a id="3481" href="Meta.Copattern.html#3481" class="Bound">ctor</a> <a id="3486" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3488" href="Meta.Copattern.html#3488" class="Bound">fields</a> <a id="3495" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3497" href="Meta.Reflection.Signature.html#1398" class="Function">get-record-type</a> <a id="3513" href="Meta.Copattern.html#3191" class="Bound">rec-name</a>
  <a id="3524" href="Meta.Copattern.html#3524" class="Bound">args</a> <a id="3529" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="3531" href="Agda.Builtin.Reflection.html#9350" class="Postulate">in-context</a> <a id="3542" class="Symbol">(</a><a id="3543" href="Data.List.Base.html#938" class="Function">reverse-fast</a> <a id="3556" href="Meta.Copattern.html#3147" class="Bound">tele</a><a id="3560" class="Symbol">)</a> <a id="3562" href="Foundations.Pi.Base.html#1914" class="Function Operator">$</a>
    <a id="3568" href="Meta.Effect.Traversable.html#396" class="Function">for</a> <a id="3572" href="Meta.Copattern.html#3488" class="Bound">fields</a> <a id="3579" class="Symbol">λ</a> <a id="3581" class="Keyword">where</a> <a id="3587" class="Symbol">(</a><a id="3588" href="Agda.Builtin.Reflection.html#3732" class="InductiveConstructor">arg</a> <a id="3592" href="Meta.Copattern.html#3592" class="Bound">field-info</a> <a id="3603" href="Meta.Copattern.html#3603" class="Bound">field-name</a><a id="3613" class="Symbol">)</a> <a id="3615" class="Symbol">→</a>
                         <a id="3642" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="3647" href="Meta.Effect.Map.html#494" class="Function Operator">&lt;$&gt;</a> <a id="3651" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="3658" class="Symbol">(</a><a id="3659" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="3663" href="Meta.Copattern.html#3603" class="Bound">field-name</a> <a id="3674" href="Meta.Literals.FromProduct.html#385" class="Function Operator">[</a> <a id="3676" href="Data.Reflection.Argument.html#1588" class="Function">argN</a> <a id="3681" href="Meta.Copattern.html#3395" class="Bound">inst-tm</a> <a id="3689" href="Meta.Literals.FromProduct.html#385" class="Function Operator">]</a><a id="3690" class="Symbol">)</a>

  <a id="3695" class="Comment">-- Builld a pointwise repacking.</a>
  <a id="3730" href="Meta.Effect.Idiom.html#354" class="Field">pure</a> <a id="3735" class="Symbol">(</a><a id="3736" href="Data.Reflection.Term.html#1873" class="Function">tel→lam</a> <a id="3744" href="Meta.Copattern.html#3147" class="Bound">tele</a> <a id="3749" class="Symbol">(</a><a id="3750" href="Agda.Builtin.Reflection.html#5194" class="InductiveConstructor">con</a> <a id="3754" href="Meta.Copattern.html#3481" class="Bound">ctor</a> <a id="3759" href="Meta.Copattern.html#3524" class="Bound">args</a><a id="3763" class="Symbol">))</a>

<a id="3767" class="Comment">--------------------------------------------------------------------------------</a>
<a id="3848" class="Comment">-- Usage</a>

<a id="3858" class="Comment">{-
Write the following in a module:
&gt;  unquoteDecl copat = declare-copattern copat thing-to-be-expanded
If you wish to give the binding a type annotation, you can also use
&gt;  copat : Your-type
&gt;  unquoteDecl copat = declare-copattern copat thing-to-be-expanded
All features of non-recursive records are supported, including instance
fields and fields with implicit arguments.
These macros also allow you to lift functions &#39;A → some-record-type&#39;
into copattern definitions. Note that Agda will generate meta for
implicits before performing quotation, so we need to explicitly
bind all implicits using a lambda before quotation!
-}</a>

<a id="declare-copattern"></a><a id="4489" href="Meta.Copattern.html#4489" class="Function">declare-copattern</a> <a id="4507" class="Symbol">:</a> <a id="4509" class="Symbol">∀</a> <a id="4511" class="Symbol">{</a><a id="4512" href="Meta.Copattern.html#4512" class="Bound">ℓ</a><a id="4513" class="Symbol">}</a> <a id="4515" class="Symbol">{</a><a id="4516" href="Meta.Copattern.html#4516" class="Bound">A</a> <a id="4518" class="Symbol">:</a> <a id="4520" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="4525" href="Meta.Copattern.html#4512" class="Bound">ℓ</a><a id="4526" class="Symbol">}</a> <a id="4528" class="Symbol">→</a> <a id="4530" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4535" class="Symbol">→</a> <a id="4537" href="Meta.Copattern.html#4516" class="Bound">A</a> <a id="4539" class="Symbol">→</a> <a id="4541" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="4544" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="4546" href="Meta.Copattern.html#4489" class="Function">declare-copattern</a> <a id="4564" class="Symbol">{</a><a id="4565" class="Argument">A</a> <a id="4567" class="Symbol">=</a> <a id="4569" href="Meta.Copattern.html#4569" class="Bound">A</a><a id="4570" class="Symbol">}</a> <a id="4572" href="Meta.Copattern.html#4572" class="Bound">nm</a> <a id="4575" href="Meta.Copattern.html#4575" class="Bound">x</a> <a id="4577" class="Symbol">=</a> <a id="4579" class="Keyword">do</a>
  <a id="4584" href="Meta.Copattern.html#4584" class="Bound">`x</a> <a id="4587" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4589" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4597" href="Meta.Copattern.html#4575" class="Bound">x</a>
  <a id="4601" href="Meta.Copattern.html#4601" class="Bound">`A</a> <a id="4604" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4606" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4614" href="Meta.Copattern.html#4569" class="Bound">A</a>
  <a id="4618" href="Meta.Copattern.html#843" class="Function">make-copattern</a> <a id="4633" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="4638" href="Meta.Copattern.html#4572" class="Bound">nm</a> <a id="4641" href="Meta.Copattern.html#4584" class="Bound">`x</a> <a id="4644" href="Meta.Copattern.html#4601" class="Bound">`A</a>

<a id="define-copattern"></a><a id="4648" href="Meta.Copattern.html#4648" class="Function">define-copattern</a> <a id="4665" class="Symbol">:</a> <a id="4667" class="Symbol">∀</a> <a id="4669" class="Symbol">{</a><a id="4670" href="Meta.Copattern.html#4670" class="Bound">ℓ</a><a id="4671" class="Symbol">}</a> <a id="4673" class="Symbol">{</a><a id="4674" href="Meta.Copattern.html#4674" class="Bound">A</a> <a id="4676" class="Symbol">:</a> <a id="4678" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="4683" href="Meta.Copattern.html#4670" class="Bound">ℓ</a><a id="4684" class="Symbol">}</a> <a id="4686" class="Symbol">→</a> <a id="4688" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="4693" class="Symbol">→</a> <a id="4695" href="Meta.Copattern.html#4674" class="Bound">A</a> <a id="4697" class="Symbol">→</a> <a id="4699" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="4702" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="4704" href="Meta.Copattern.html#4648" class="Function">define-copattern</a> <a id="4721" class="Symbol">{</a><a id="4722" class="Argument">A</a> <a id="4724" class="Symbol">=</a> <a id="4726" href="Meta.Copattern.html#4726" class="Bound">A</a><a id="4727" class="Symbol">}</a> <a id="4729" href="Meta.Copattern.html#4729" class="Bound">nm</a> <a id="4732" href="Meta.Copattern.html#4732" class="Bound">x</a> <a id="4734" class="Symbol">=</a> <a id="4736" class="Keyword">do</a>
  <a id="4741" href="Meta.Copattern.html#4741" class="Bound">`x</a> <a id="4744" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4746" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4754" href="Meta.Copattern.html#4732" class="Bound">x</a>
  <a id="4758" href="Meta.Copattern.html#4758" class="Bound">`A</a> <a id="4761" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="4763" href="Agda.Builtin.Reflection.html#9089" class="Postulate">quoteTC</a> <a id="4771" href="Meta.Copattern.html#4726" class="Bound">A</a>
  <a id="4775" href="Meta.Copattern.html#843" class="Function">make-copattern</a> <a id="4790" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="4796" href="Meta.Copattern.html#4729" class="Bound">nm</a> <a id="4799" href="Meta.Copattern.html#4741" class="Bound">`x</a> <a id="4802" href="Meta.Copattern.html#4758" class="Bound">`A</a>

<a id="4806" class="Comment">{-
There is a slight caveat with level-polymorphic defintions, as
they cannot be quoted into any `Type ℓ`. With this in mind,
we also provide a pair of macros that work over `Typeω` instead.
-}</a>

<a id="declare-copattern-levels"></a><a id="5001" href="Meta.Copattern.html#5001" class="Function">declare-copattern-levels</a> <a id="5026" class="Symbol">:</a> <a id="5028" class="Symbol">∀</a> <a id="5030" class="Symbol">{</a><a id="5031" href="Meta.Copattern.html#5031" class="Bound">U</a> <a id="5033" class="Symbol">:</a> <a id="5035" href="Foundations.Prim.Type.html#349" class="Primitive">Typeω</a><a id="5040" class="Symbol">}</a> <a id="5042" class="Symbol">→</a> <a id="5044" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5049" class="Symbol">→</a> <a id="5051" href="Meta.Copattern.html#5031" class="Bound">U</a> <a id="5053" class="Symbol">→</a> <a id="5055" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="5058" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="5060" href="Meta.Copattern.html#5001" class="Function">declare-copattern-levels</a> <a id="5085" href="Meta.Copattern.html#5085" class="Bound">nm</a> <a id="5088" href="Meta.Copattern.html#5088" class="Bound">A</a> <a id="5090" class="Symbol">=</a> <a id="5092" class="Keyword">do</a>
  <a id="5097" href="Meta.Copattern.html#5097" class="Bound">`A</a> <a id="5100" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5102" href="Agda.Builtin.Reflection.html#9195" class="Postulate">quoteωTC</a> <a id="5111" href="Meta.Copattern.html#5088" class="Bound">A</a>
  <a id="5115" class="Comment">-- Cannot quote things in type Typeω, but we can infer their type.</a>
  <a id="5184" href="Meta.Copattern.html#5184" class="Bound">`U</a> <a id="5187" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5189" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="5200" href="Meta.Copattern.html#5097" class="Bound">`A</a>
  <a id="5205" href="Meta.Copattern.html#843" class="Function">make-copattern</a> <a id="5220" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="5225" href="Meta.Copattern.html#5085" class="Bound">nm</a> <a id="5228" href="Meta.Copattern.html#5097" class="Bound">`A</a> <a id="5231" href="Meta.Copattern.html#5184" class="Bound">`U</a>

<a id="define-copattern-levels"></a><a id="5235" href="Meta.Copattern.html#5235" class="Function">define-copattern-levels</a> <a id="5259" class="Symbol">:</a> <a id="5261" class="Symbol">∀</a> <a id="5263" class="Symbol">{</a><a id="5264" href="Meta.Copattern.html#5264" class="Bound">U</a> <a id="5266" class="Symbol">:</a> <a id="5268" href="Foundations.Prim.Type.html#349" class="Primitive">Typeω</a><a id="5273" class="Symbol">}</a> <a id="5275" class="Symbol">→</a> <a id="5277" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5282" class="Symbol">→</a> <a id="5284" href="Meta.Copattern.html#5264" class="Bound">U</a> <a id="5286" class="Symbol">→</a> <a id="5288" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="5291" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="5293" href="Meta.Copattern.html#5235" class="Function">define-copattern-levels</a> <a id="5317" href="Meta.Copattern.html#5317" class="Bound">nm</a> <a id="5320" href="Meta.Copattern.html#5320" class="Bound">A</a> <a id="5322" class="Symbol">=</a> <a id="5324" class="Keyword">do</a>
  <a id="5329" href="Meta.Copattern.html#5329" class="Bound">`A</a> <a id="5332" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5334" href="Agda.Builtin.Reflection.html#9195" class="Postulate">quoteωTC</a> <a id="5343" href="Meta.Copattern.html#5320" class="Bound">A</a>
  <a id="5347" class="Comment">-- Cannot quote things in type Typeω, but we can infer their type.</a>
  <a id="5416" href="Meta.Copattern.html#5416" class="Bound">`U</a> <a id="5419" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5421" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="5432" href="Meta.Copattern.html#5329" class="Bound">`A</a>
  <a id="5437" href="Meta.Copattern.html#843" class="Function">make-copattern</a> <a id="5452" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="5458" href="Meta.Copattern.html#5317" class="Bound">nm</a> <a id="5461" href="Meta.Copattern.html#5329" class="Bound">`A</a> <a id="5464" href="Meta.Copattern.html#5416" class="Bound">`U</a>

<a id="5468" class="Comment">{-
Another common pattern is that two records `r : R p` and `s : R q` may contain
the same data, but they are parameterized by different values.
The `define-eta-expansion` macro will automatically construct a function
`R p → R q` that eta-expands the first record out into a copattern definition.
-}</a>

<a id="define-eta-expansion"></a><a id="5769" href="Meta.Copattern.html#5769" class="Function">define-eta-expansion</a> <a id="5790" class="Symbol">:</a> <a id="5792" href="Agda.Builtin.Reflection.html#488" class="Postulate">Name</a> <a id="5797" class="Symbol">→</a> <a id="5799" href="Agda.Builtin.Reflection.html#8602" class="Postulate">TC</a> <a id="5802" href="Agda.Builtin.Unit.html#175" class="Record">⊤</a>
<a id="5804" href="Meta.Copattern.html#5769" class="Function">define-eta-expansion</a> <a id="5825" href="Meta.Copattern.html#5825" class="Bound">nm</a> <a id="5828" class="Symbol">=</a> <a id="5830" class="Keyword">do</a>
  <a id="5835" href="Meta.Copattern.html#5835" class="Bound">tp</a> <a id="5838" href="Meta.Effect.Bind.html#283" class="Field Operator">←</a> <a id="5840" href="Agda.Builtin.Reflection.html#8993" class="Postulate">reduce</a> <a id="5847" href="Meta.Effect.Bind.html#427" class="Function Operator">=&lt;&lt;</a> <a id="5851" href="Agda.Builtin.Reflection.html#8878" class="Postulate">infer-type</a> <a id="5862" class="Symbol">(</a><a id="5863" href="Agda.Builtin.Reflection.html#5251" class="InductiveConstructor">def</a> <a id="5867" href="Meta.Copattern.html#5825" class="Bound">nm</a> <a id="5870" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5872" class="Symbol">)</a>
  <a id="5876" class="Keyword">let</a> <a id="5880" href="Meta.Copattern.html#5880" class="Bound">tele</a> <a id="5885" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5887" class="Symbol">_</a> <a id="5889" class="Symbol">=</a> <a id="5891" href="Data.Reflection.Term.html#1405" class="Function">pi-view</a> <a id="5899" href="Meta.Copattern.html#5835" class="Bound">tp</a>
  <a id="5904" class="Keyword">let</a> <a id="5908" href="Meta.Copattern.html#5908" class="Bound">tm</a> <a id="5911" class="Symbol">=</a> <a id="5913" href="Data.Reflection.Term.html#1873" class="Function">tel→lam</a> <a id="5921" href="Meta.Copattern.html#5880" class="Bound">tele</a> <a id="5926" class="Symbol">(</a><a id="5927" href="Agda.Builtin.Reflection.html#5138" class="InductiveConstructor">var</a> <a id="5931" class="Number">0</a> <a id="5933" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5935" class="Symbol">)</a>
  <a id="5939" href="Meta.Copattern.html#843" class="Function">make-copattern</a> <a id="5954" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="5960" href="Meta.Copattern.html#5825" class="Bound">nm</a> <a id="5963" href="Meta.Copattern.html#5908" class="Bound">tm</a> <a id="5966" href="Meta.Copattern.html#5835" class="Bound">tp</a>

<a id="5970" class="Comment">--------------------------------------------------------------------------------</a>
<a id="6051" class="Comment">-- Tests</a>

<a id="6061" class="Keyword">private</a> <a id="6069" class="Keyword">module</a> <a id="Test"></a><a id="6076" href="Meta.Copattern.html#6076" class="Module">Test</a> <a id="6081" class="Keyword">where</a>
  <a id="6089" class="Comment">-- Record type that uses all interesting features.</a>
  <a id="6142" class="Keyword">record</a> <a id="Test.Record"></a><a id="6149" href="Meta.Copattern.html#6149" class="Record">Record</a> <a id="6156" class="Symbol">{</a><a id="6157" href="Meta.Copattern.html#6157" class="Bound">ℓ</a><a id="6158" class="Symbol">}</a> <a id="6160" class="Symbol">(</a><a id="6161" href="Meta.Copattern.html#6161" class="Bound">A</a> <a id="6163" class="Symbol">:</a> <a id="6165" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="6170" href="Meta.Copattern.html#6157" class="Bound">ℓ</a><a id="6171" class="Symbol">)</a> <a id="6173" class="Symbol">:</a> <a id="6175" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="6180" href="Meta.Copattern.html#6157" class="Bound">ℓ</a> <a id="6182" class="Keyword">where</a>
    <a id="6192" class="Keyword">no-eta-equality</a>
    <a id="6212" class="Keyword">constructor</a> <a id="Test.mk"></a><a id="6224" href="Meta.Copattern.html#6224" class="InductiveConstructor">mk</a>
    <a id="6231" class="Keyword">field</a>
      <a id="6243" class="Symbol">⦃</a> <a id="Test.Record.c"></a><a id="6245" href="Meta.Copattern.html#6245" class="Field">c</a> <a id="6247" class="Symbol">⦄</a> <a id="6249" class="Symbol">:</a> <a id="6251" href="Meta.Copattern.html#6161" class="Bound">A</a>
      <a id="6259" class="Symbol">{</a> <a id="Test.Record.f"></a><a id="6261" href="Meta.Copattern.html#6261" class="Field">f</a> <a id="6263" class="Symbol">}</a> <a id="6265" class="Symbol">:</a> <a id="6267" href="Meta.Copattern.html#6161" class="Bound">A</a> <a id="6269" class="Symbol">→</a> <a id="6271" href="Meta.Copattern.html#6161" class="Bound">A</a>
      <a id="Test.Record.const′"></a><a id="6279" href="Meta.Copattern.html#6279" class="Field">const′</a> <a id="6286" class="Symbol">:</a> <a id="6288" class="Symbol">∀</a> <a id="6290" class="Symbol">{</a><a id="6291" href="Meta.Copattern.html#6291" class="Bound">x</a><a id="6292" class="Symbol">}</a> <a id="6294" class="Symbol">→</a> <a id="6296" href="Meta.Copattern.html#6261" class="Field">f</a> <a id="6298" href="Meta.Copattern.html#6291" class="Bound">x</a> <a id="6300" href="Foundations.Prim.Kan.html#1264" class="Function Operator">＝</a> <a id="6302" href="Meta.Copattern.html#6245" class="Field">c</a>

  <a id="6307" class="Comment">-- Record created via a constructor.</a>
  <a id="Test.via-ctor"></a><a id="6346" href="Meta.Copattern.html#6346" class="Function">via-ctor</a> <a id="6355" class="Symbol">:</a> <a id="6357" href="Meta.Copattern.html#6149" class="Record">Record</a> <a id="6364" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="6368" href="Meta.Copattern.html#6346" class="Function">via-ctor</a> <a id="6377" class="Symbol">=</a> <a id="6379" href="Meta.Copattern.html#6224" class="InductiveConstructor">mk</a> <a id="6382" class="Symbol">⦃</a> <a id="6384" class="Argument">c</a> <a id="6386" class="Symbol">=</a> <a id="6388" class="Number">0</a> <a id="6390" class="Symbol">⦄</a> <a id="6392" class="Symbol">{</a><a id="6393" class="Argument">f</a> <a id="6395" class="Symbol">=</a> <a id="6397" class="Symbol">λ</a> <a id="6399" href="Meta.Copattern.html#6399" class="Bound">_</a> <a id="6401" class="Symbol">→</a> <a id="6403" class="Number">0</a><a id="6404" class="Symbol">}</a> <a id="6406" href="Foundations.Correspondences.Binary.Reflexive.html#337" class="Field">refl</a>

  <a id="6414" class="Comment">-- Both macros work.</a>
  <a id="6437" class="Keyword">unquoteDecl</a> <a id="Test.copat-decl-via-ctor"></a><a id="6449" href="Meta.Copattern.html#6449" class="Function">copat-decl-via-ctor</a> <a id="6469" class="Symbol">=</a> <a id="6471" href="Meta.Copattern.html#4489" class="Function">declare-copattern</a> <a id="6489" href="Meta.Copattern.html#6449" class="Function">copat-decl-via-ctor</a> <a id="6509" href="Meta.Copattern.html#6346" class="Function">via-ctor</a>

  <a id="Test.copat-def-via-ctor"></a><a id="6521" href="Meta.Copattern.html#6521" class="Function">copat-def-via-ctor</a> <a id="6540" class="Symbol">:</a> <a id="6542" href="Meta.Copattern.html#6149" class="Record">Record</a> <a id="6549" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
  <a id="6553" class="Keyword">unquoteDef</a> <a id="6564" href="Meta.Copattern.html#6521" class="Function">copat-def-via-ctor</a> <a id="6583" class="Symbol">=</a> <a id="6585" href="Meta.Copattern.html#4648" class="Function">define-copattern</a> <a id="6602" href="Meta.Copattern.html#6521" class="Function">copat-def-via-ctor</a> <a id="6621" href="Meta.Copattern.html#6346" class="Function">via-ctor</a>

  <a id="6633" class="Comment">-- Record created by a function.</a>
  <a id="6668" class="Keyword">module</a> <a id="6675" href="Meta.Copattern.html#6675" class="Module">_</a> <a id="6677" class="Symbol">(</a><a id="6678" href="Meta.Copattern.html#6678" class="Bound">r</a> <a id="6680" class="Symbol">:</a> <a id="6682" href="Meta.Copattern.html#6149" class="Record">Record</a> <a id="6689" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="6690" class="Symbol">)</a> <a id="6692" class="Keyword">where</a>
    <a id="6702" class="Keyword">open</a> <a id="6707" href="Meta.Copattern.html#6149" class="Module">Record</a> <a id="6714" href="Meta.Copattern.html#6678" class="Bound">r</a>
    <a id="6720" href="Meta.Copattern.html#6720" class="Function">via-function</a> <a id="6733" class="Symbol">:</a> <a id="6735" href="Meta.Copattern.html#6149" class="Record">Record</a> <a id="6742" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
    <a id="6748" href="Meta.Copattern.html#6720" class="Function">via-function</a> <a id="6761" class="Symbol">.</a><a id="6762" href="Meta.Copattern.html#6245" class="Field">c</a> <a id="6764" class="Symbol">=</a> <a id="6766" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6770" href="Meta.Copattern.html#6245" class="Field">c</a>
    <a id="6776" href="Meta.Copattern.html#6720" class="Function">via-function</a> <a id="6789" class="Symbol">.</a><a id="6790" href="Meta.Copattern.html#6261" class="Field">f</a> <a id="6792" class="Symbol">=</a> <a id="6794" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6798" href="Foundations.Pi.Base.html#2101" class="Function Operator">∘</a> <a id="6800" href="Meta.Copattern.html#6261" class="Field">f</a>
    <a id="6806" href="Meta.Copattern.html#6720" class="Function">via-function</a> <a id="6819" class="Symbol">.</a><a id="6820" href="Meta.Copattern.html#6279" class="Field">const′</a> <a id="6827" class="Symbol">=</a> <a id="6829" href="Foundations.Prim.Kan.html#1724" class="Function">ap</a> <a id="6832" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6836" href="Meta.Copattern.html#6279" class="Field">const′</a>

  <a id="6846" class="Comment">-- Also works when applied to the result of a function.</a>
  <a id="6904" class="Keyword">unquoteDecl</a> <a id="Test.copat-decl-via-function"></a><a id="6916" href="Meta.Copattern.html#6916" class="Function">copat-decl-via-function</a> <a id="6940" class="Symbol">=</a> <a id="6942" href="Meta.Copattern.html#4489" class="Function">declare-copattern</a> <a id="6960" href="Meta.Copattern.html#6916" class="Function">copat-decl-via-function</a> <a id="6984" class="Symbol">(</a><a id="6985" href="Meta.Copattern.html#6720" class="Function">via-function</a> <a id="6998" href="Meta.Copattern.html#6346" class="Function">via-ctor</a><a id="7006" class="Symbol">)</a>

  <a id="7011" class="Comment">-- Test to see how we handle unused parameters.</a>
  <a id="7061" class="Keyword">record</a> <a id="Test.Unused"></a><a id="7068" href="Meta.Copattern.html#7068" class="Record">Unused</a> <a id="7075" class="Symbol">(</a><a id="7076" href="Meta.Copattern.html#7076" class="Bound">n</a> <a id="7078" class="Symbol">:</a> <a id="7080" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="7081" class="Symbol">)</a> <a id="7083" class="Symbol">:</a> <a id="7085" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7090" class="Keyword">where</a>
    <a id="7100" class="Keyword">field</a>
      <a id="Test.Unused.actual"></a><a id="7112" href="Meta.Copattern.html#7112" class="Field">actual</a> <a id="7119" class="Symbol">:</a> <a id="7121" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>

  <a id="Test.zero-unused-param"></a><a id="7126" href="Meta.Copattern.html#7126" class="Function">zero-unused-param</a> <a id="7144" class="Symbol">:</a> <a id="7146" href="Meta.Copattern.html#7068" class="Record">Unused</a> <a id="7153" class="Number">0</a>
  <a id="7157" href="Meta.Copattern.html#7126" class="Function">zero-unused-param</a> <a id="7175" class="Symbol">=</a> <a id="7177" class="Keyword">record</a> <a id="7184" class="Symbol">{</a> <a id="7186" href="Meta.Copattern.html#7112" class="Field">actual</a> <a id="7193" class="Symbol">=</a> <a id="7195" class="Number">0</a> <a id="7197" class="Symbol">}</a>

  <a id="Test.one-unused-param"></a><a id="7202" href="Meta.Copattern.html#7202" class="Function">one-unused-param</a> <a id="7219" class="Symbol">:</a> <a id="7221" class="Symbol">∀</a> <a id="7223" class="Symbol">{</a><a id="7224" href="Meta.Copattern.html#7224" class="Bound">n</a><a id="7225" class="Symbol">}</a> <a id="7227" class="Symbol">→</a> <a id="7229" href="Meta.Copattern.html#7068" class="Record">Unused</a> <a id="7236" href="Meta.Copattern.html#7224" class="Bound">n</a>
  <a id="7240" class="Keyword">unquoteDef</a> <a id="7251" href="Meta.Copattern.html#7202" class="Function">one-unused-param</a> <a id="7268" class="Symbol">=</a> <a id="7270" href="Meta.Copattern.html#4648" class="Function">define-copattern</a> <a id="7287" href="Meta.Copattern.html#7202" class="Function">one-unused-param</a> <a id="7304" href="Meta.Copattern.html#7126" class="Function">zero-unused-param</a>

  <a id="7325" class="Comment">-- Functions into records that are universe polymorphic</a>
  <a id="Test.neat"></a><a id="7383" href="Meta.Copattern.html#7383" class="Function">neat</a> <a id="7388" class="Symbol">:</a> <a id="7390" class="Symbol">∀</a> <a id="7392" class="Symbol">{</a><a id="7393" href="Meta.Copattern.html#7393" class="Bound">ℓ</a><a id="7394" class="Symbol">}</a> <a id="7396" class="Symbol">{</a><a id="7397" href="Meta.Copattern.html#7397" class="Bound">A</a> <a id="7399" class="Symbol">:</a> <a id="7401" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7406" href="Meta.Copattern.html#7393" class="Bound">ℓ</a><a id="7407" class="Symbol">}</a> <a id="7409" class="Symbol">→</a> <a id="7411" href="Meta.Copattern.html#7397" class="Bound">A</a> <a id="7413" class="Symbol">→</a> <a id="7415" href="Meta.Copattern.html#6149" class="Record">Record</a> <a id="7422" href="Meta.Copattern.html#7397" class="Bound">A</a>
  <a id="7426" href="Meta.Copattern.html#7383" class="Function">neat</a> <a id="7431" href="Meta.Copattern.html#7431" class="Bound">a</a> <a id="7433" class="Symbol">.</a><a id="7434" href="Meta.Copattern.html#6245" class="Field">Record.c</a> <a id="7443" class="Symbol">=</a> <a id="7445" href="Meta.Copattern.html#7431" class="Bound">a</a>
  <a id="7449" href="Meta.Copattern.html#7383" class="Function">neat</a> <a id="7454" href="Meta.Copattern.html#7454" class="Bound">a</a> <a id="7456" class="Symbol">.</a><a id="7457" href="Meta.Copattern.html#6261" class="Field">Record.f</a> <a id="7466" class="Symbol">_</a> <a id="7468" class="Symbol">=</a> <a id="7470" href="Meta.Copattern.html#7454" class="Bound">a</a>
  <a id="7474" href="Meta.Copattern.html#7383" class="Function">neat</a> <a id="7479" href="Meta.Copattern.html#7479" class="Bound">a</a> <a id="7481" class="Symbol">.</a><a id="7482" href="Meta.Copattern.html#6279" class="Field">Record.const′</a> <a id="7496" class="Symbol">=</a> <a id="7498" href="Foundations.Correspondences.Binary.Reflexive.html#337" class="Field">refl</a>

  <a id="Test.cool"></a><a id="7506" href="Meta.Copattern.html#7506" class="Function">cool</a> <a id="7511" class="Symbol">:</a> <a id="7513" class="Symbol">∀</a> <a id="7515" class="Symbol">{</a><a id="7516" href="Meta.Copattern.html#7516" class="Bound">ℓ</a><a id="7517" class="Symbol">}</a> <a id="7519" class="Symbol">{</a><a id="7520" href="Meta.Copattern.html#7520" class="Bound">A</a> <a id="7522" class="Symbol">:</a> <a id="7524" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7529" href="Meta.Copattern.html#7516" class="Bound">ℓ</a><a id="7530" class="Symbol">}</a> <a id="7532" class="Symbol">→</a> <a id="7534" href="Meta.Copattern.html#7520" class="Bound">A</a> <a id="7536" class="Symbol">→</a> <a id="7538" href="Meta.Copattern.html#6149" class="Record">Record</a> <a id="7545" href="Meta.Copattern.html#7520" class="Bound">A</a>
  <a id="7549" class="Keyword">unquoteDef</a> <a id="7560" href="Meta.Copattern.html#7506" class="Function">cool</a> <a id="7565" class="Symbol">=</a> <a id="7567" href="Meta.Copattern.html#5235" class="Function">define-copattern-levels</a> <a id="7591" href="Meta.Copattern.html#7506" class="Function">cool</a> <a id="7596" class="Symbol">λ</a> <a id="7598" class="Symbol">{</a><a id="7599" href="Meta.Copattern.html#7599" class="Bound">ℓ</a><a id="7600" class="Symbol">}</a> <a id="7602" class="Symbol">{</a><a id="7603" href="Meta.Copattern.html#7603" class="Bound">A</a> <a id="7605" class="Symbol">:</a> <a id="7607" href="Foundations.Prim.Type.html#322" class="Primitive">Type</a> <a id="7612" href="Meta.Copattern.html#7599" class="Bound">ℓ</a><a id="7613" class="Symbol">}</a> <a id="7615" class="Symbol">→</a> <a id="7617" href="Meta.Copattern.html#7383" class="Function">neat</a>

  <a id="7625" class="Comment">-- Eta-expanders</a>
  <a id="Test.expander"></a><a id="7644" href="Meta.Copattern.html#7644" class="Function">expander</a> <a id="7653" class="Symbol">:</a> <a id="7655" class="Symbol">∀</a> <a id="7657" class="Symbol">{</a><a id="7658" href="Meta.Copattern.html#7658" class="Bound">m</a> <a id="7660" href="Meta.Copattern.html#7660" class="Bound">n</a> <a id="7662" class="Symbol">:</a> <a id="7664" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="7665" class="Symbol">}</a> <a id="7667" class="Symbol">→</a> <a id="7669" href="Meta.Copattern.html#7068" class="Record">Unused</a> <a id="7676" href="Meta.Copattern.html#7658" class="Bound">m</a> <a id="7678" class="Symbol">→</a> <a id="7680" href="Meta.Copattern.html#7068" class="Record">Unused</a> <a id="7687" href="Meta.Copattern.html#7660" class="Bound">n</a>
  <a id="7691" class="Keyword">unquoteDef</a> <a id="7702" href="Meta.Copattern.html#7644" class="Function">expander</a> <a id="7711" class="Symbol">=</a> <a id="7713" href="Meta.Copattern.html#5769" class="Function">define-eta-expansion</a> <a id="7734" href="Meta.Copattern.html#7644" class="Function">expander</a>
</pre></body></html>